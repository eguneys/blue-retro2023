var t=Object.defineProperty,s=(s,e,i)=>(((s,e,i)=>{e in s?t(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i})(s,"symbol"!=typeof e?e+"":e,i),i);const e=new class{constructor(){s(this,"ticks_per_second",1e3),s(this,"ticks",0),s(this,"seconds",0),s(this,"delta",0),s(this,"previous_ticks",0),s(this,"previous_seconds",0),s(this,"pause_timer",0)}t(t){t>=this.i&&(this.i=t)}h(t,s=0){let e=this.o,i=this.delta;return Math.floor((e-s-i)/t)<Math.floor((e-s)/t)}l(t,s){let e=Math.floor(t)-this.delta;return t>=s&&e<s}u(t,s=0){let e=this.o;return r=2*t,(i=e-s)-Math.floor(i/r)*r>=t;var i,r}};const i=new class{constructor(){s(this,"app_time_last"),s(this,"app_time_accumulator",0)}A(t){const s=()=>{t.p()},i=r=>{let h=Math.min(25,r-(this.g??r));this.g=r,this.C+=h,e.delta=h/e.ticks_per_second,e.i>0?e.i-=e.delta:(e.m=e.I,e.I+=h,e.k=e.o,e.o+=e.delta,s()),t.D(),requestAnimationFrame(i)};requestAnimationFrame(i)}},r=class{constructor(){s(this,"_btn_pre",!1),s(this,"_btn",0)}get M(){return this._}get B(){return this.J>0}Y(t){this.J="down"===t?1:0}update(){1!==this.J||this._?this._=!1:this._=!0,1===this.J&&(this.J=2)}};s(r,"make",(()=>new r));let h=r;const n=new class{constructor(){s(this,"action_map"),s(this,"key_map"),this.K={jump:h.make(),left:h.make(),right:h.make(),down:h.make()},this.W={w:"jump",a:"left",s:"down",d:"right",ArrowUp:"jump",ArrowLeft:"left",ArrowDown:"down",ArrowRight:"right"},document.addEventListener("keydown",(t=>{var s;return null==(s=this.K[this.W[t.key]])?void 0:s.Y("down")})),document.addEventListener("keyup",(t=>{var s;return null==(s=this.K[this.W[t.key]])?void 0:s.Y("up")}))}M(t){return this.K[t].M}B(t){return this.K[t].B}update(){for(let t of Object.keys(this.K))this.K[t].update()}};const a=new class{constructor(){s(this,"image"),s(this,"info")}async load(){var t;this.S=await(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAACwCAYAAADUkyaSAAAJeElEQVR42u2dO5LkNgyGdRofwYEP4GwTp44dzskc+gy+ghOHmzjZwJFD2bPrmepRiyQeP8DXjypVTUst9hD4BIAQKR0HhUKhUCgUygjyzw8nN8e2BSAU6o6A9Nfd+enLWdsISK+wORAglmN9Aax10hNzUedZDPx4jvZ8zW8bAYnyIDEAtgCpKb6mzJqRaufW2mkl1tbflp4LDDHv+87jRHoQPIAeQHp8V7LP014wIE/7wIDgAcwCxONtpIB4PJL3/x4kB8ED2HLBiLDhyRm89QcPIJa2BgMEn4NoktYZRh0SuKS/DwLk9apubXMCwroHzIN8BaHy2ZWkQgFEu/RVaymT5SA4ACWd3BWQCQtluXUQICC//vT9+bh5z7+24W0/E5C7+kRkHQQPiCHEtAz0uK9kwBYA0s/Xv03wSJNbowFr+xCA4Np3dLyk+DujSI5rDKs5V+OJIvRULWSBS+349p2AzJ5qZAKyTjJGQAiIOAdphJYVAKn2BZiDrDecqwCymhqqgGw9/O8AyO9//HlaNwKyCSDFTPzvv867v1vnEZAsQAT1D28OMhIgqhxky/tWjk5LANGGilcoHrcMQDJ0RUAM3gLpeQhIrxBTUYIFkKuHuHqJoQAB382NlvxZ7Y1E1QpI7XMPQEwJqgGQ6HUxfe7mOkcyUkB6DnMzAcEb8LmNYTyIFZC7EBM5hB0NkEgPkjOrXTHUlYxaeoUPSIgB3+7PWBfzYV8YIMYrz2ronoBE6ynWgD1yEAKSBkhEDjIFINqhLAEBJqmhs9oFHa+Vpx8BKY1csm/EWfsSBUjGupjYWe2N5KymTCkgo9ULb/sUNCcVa8By+93qIFsBElQHwRlwwEKZFJDMm26zAZJZKOsCSCsHGTEhVecgSYUyJCB3s9rTAbEMcx+9yWiAROimBQjOgHpofIA47+bWABnVg1R1A16bG7kuJkbA80GWAgSoq3nF2GltDjIyIOZiGQHRX3mz5SAqL0JADvHzQWqAtMrsUwAS8HyQNQBRDnVbxh8dEPMQl4C0v7MKIGi9rA+IcKhbAkQSYka6WWca4m4PCHiY25IdbvcTEAJCQDyAjHgDbyVA8tbFOAEp5RYjTgHo9QiqudfFCOsg2oVTowIiroMAAMEb8LmN3HUxlTqINrewTEPstnAq8TGY862LCQTEsiY32stkArLGupggQFSdTVx9l+1BsAbMzEEUr/+0Lt7WAHL9O3XxtkQX262LUXY44gEyPQDJ0tf862ICALHmJVkhpgcg866LUdyDQT2jrDayyUhS1c8oA3mQNdbF8DGY0Kccrrcuhg/SDQMks1CGB4SP4pbpYuD3xdRqLxhAApPUKTwHUE8tAyIBwS+hICDLvC8mRvhCIc4HceUgfCUZpxxCvuMESHv+jC81JCDUywaK4IuV5Xrg0ksKdaXpdJRXifRW0mRT8vsE5JCXlh3PFXG3a21bMlwlIIYcRGrImtKlsVxr0JYX8ADCHOTQPWbJAwjquxYjo87lKEYJiMcreK94j6eznktAgAkk6jyLERyTelS/TUAWqWFQd+wkdcdOUndDuGNuuo1CoVAoFAqFQqFQKBQKhbKG/Pz588nNvm0BCC+TeN2dn768aDfN/xLWPgFJBeRsbHsCkuWSs92/EZCSweYFRKr40vfe/rYYTWP0u9+MBMwByFoepGTsqzJLBiodl0JX+rsEYqtfLZAtejGEmG+G+u2XcwkP0jK2BZAI6BBtBgPy0VAExHfcAoC3zVRAVslBpOECaUxPCPC2SUAKnWwVhDQJo+W7o7QpKYyZAXkNK61tZEBY4cDr6slLfIOg/JmAbA7IqiFmJxjCQszKSapVXn787nzcvOdf2/C2H62XRqFsfUBaBnrcVzJgCwDp5+vfFngkXtQJyEtl39iASENMSfF3RpEc1xhWc67GE2n15K6kzlhql3Yc4cp7SxYgy2TmBISAqEPMroAgc5ClAJEcR40WRgCk1A+rbrYARJKgWn/T80KhiJcN1QCp6WB7QKLyj5YxNa8pk7bp6QsBISAExBNi7r4jzUEs4cDyhm5r2Cn1Q5KoM0kVJKqRV7YFnsd9UkDQelkWEO0CIQsgVwNLPYQ0/CABkcyNGcmWrWUVEEA0Q0MrILXPCEDeNk2IsRTMtICEGPDSvuVYCCDWhDQaEGt4ywIEbsCbNkI9CCq0RIYY6bkIQJAhJsSABQ/1vu//FzhDANEkpyW3nPm2bMvIRhtiLPpJNWDDC3UBpHbV9QTCMqKy1kBQISYaEGgOcudWswC5Cz2WEBQBCOpmXVYOkgKINW6/GUFr5NJ3EIDURjWZt/vTktT/vFJrg3mQu6unlYNoRxteQFpe5+2zJgdBTzkMM2ABsq/tVD6HVlJrV10vQCSfa+HvDhB0JTXEgIfs9e7m0dIugLQKZ9mAIEOM5lw3IJJSuxQQbQ5iTVKlxTctIMh1MdGAaDY3IJLktJWDZIoUKksdxKsrSaEMlaSGiKfTGkAih6+Rw9woQGr7hgfEM2m5Boh1+IqCSwtIRIh5qqQCS+0pgGiOZwKCqI1YAEEmqVOKZ9LyyIDceZxaDmLRAeekKvMPTw6iOaYd2bTqIJyTmgyIJV+wTFQmIIOEGM2k5dYEodEA4aRlQDVQM3HIAwhyCKzJQdB6WR4Qz8wya4gZrQ4ScbNuKUDQhbII0SavvW/3E5AOgGjCGQEJCjEoQCLyjEhAGGIOW7XQOmlZMlLRhI0WIN5Jy+hKasa6mNCFUxpALImhFBCpV2jB5F32EAGI5VjX9rWPnx4JEMuoRQvIbOti4O1nLr2UhA7ktICRl16+7wMvewhdOJWxeDuiAOYFRFoHQXmQD/tmXjjV+k4vQDyjFg0gCN0tlYNEAYJcjlkCxPMAGQKi6CQ6xCDyEkmIsUKnDTEIQCLXxcDbtnba8xhM7cgGPWKx9gM5qx25LuYWQFTbHkA8xpzhMZiRgCwVYtCAjCbWO7pMUg8+aTkiSY1aFxPSPp/VnnezLnpdTEj7fNtD7uMfItfFhLTPFwpxPkhYoUwCy92VuuMrybYHxAuQ9vzZXmq4DCB8LapcD9sCclCoKwJCXYWEGGnY0YSoEdtkiDEmY29/t6ApnVP7rqXN1v9sbZNJKhgQibItx9HQSaEgIIMCcjV2jzYJCAgQrzEleUKtTWsIkswxJSBKRUiNKXX31nqEFuSo3yIgQUWnzOLWCrrbAhDqjp0kICt3kpt942VCoVAoFAqF4pd/AUxY8tCXRF5pAAAAAElFTkSuQmCC",new Promise((s=>{let e=new Image;e.onload=()=>s(e),e.src=t}))),this.info="player\n\n0*1*hit\n2*3*jump\n4*5*attack\n6*7*idle\n8*11*walk\n\n4*4*16*16*88*88*24*24\n4*4*16*16*112*88*24*24\n4*4*16*16*88*112*24*24\n4*4*16*16*112*112*24*24\n4*4*16*16*88*136*24*24\n4*4*16*16*112*136*24*24\n4*4*16*16*88*0*24*24\n4*4*16*16*112*0*24*24\n4*4*16*16*88*24*24*24\n4*4*16*16*112*24*24*24\n4*4*16*16*88*48*24*24\n4*4*16*16*112*48*24*24\n\n\nsun\n\n0*0*idle\n1*1*idle2\n\n4*4*80*80*0*0*88*88\n4*4*80*80*0*88*88*88".split("\n\n\n").map((t=>{let[s,e,i]=t.split("\n\n");return{name:s,tags:e.split("\n").map((t=>{let[s,e,i]=t.split("*");return{from:parseInt(s),to:parseInt(e),name:i}})),U:i.split("\n").map((t=>{let[s,e,i,r,h,n,a,o]=t.split("*").map((t=>parseInt(t)));return{fx:s,fy:e,R:i,v:r,T:h,N:n,j:a,F:o,duration:100}}))}}))}},o="#735973",c="#eeeaf6",l="#b42c73",u="#de505a",A=class{constructor(t,s){this.canvas=t,this.L=s}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(t=o){let{L:s}=this;s.clearRect(0,0,this.width,this.height)}rect(t=u,s,e,i,r){let{L:h}=this;h.fillStyle=t,h.fillRect(s,e,i,r)}V(t=u,s,e,i,r){let{L:h}=this;h.strokeStyle=t,h.lineWidth=1,h.strokeRect(s+1,e+1,i-2,r-2)}G(t,s,e,i=64,r=c){let{L:h}=this;h.measureText(t).width,h.font=`${i}px 'Courier New', monospace`,h.fillStyle=r,h.fillText(t,s,e)}q(t,s,e,i=1,r=1){let{fx:h,fy:n,T:a,N:o,j:c,F:l}=t.current_frame,{P:u,H:A}=t,d=s-h-u,p=e-n-A;this.O(d,p,a,o,c,l,i,r)}O(t,s,e,i,r,h,n,o){let{L:c}=this,{S:l}=a;c.save();let u=r,A=h,d=u*Math.abs(n),p=A*Math.abs(o);c.scale(n,o),n<0&&(t*=-1,t-=d),o<0&&(s*=-1,s-=p),c.drawImage(l,e,i,u,A,Math.round(t),Math.round(s),d,p),c.restore()}};s(A,"make",((t,s,e=!0)=>{let i=document.createElement("canvas");e&&i.classList.add("pixelated");let r=i.getContext("2d");const h=()=>{i.width=t,i.height=s,r.imageSmoothingEnabled=e};return document.addEventListener("resize",h),h(),new A(i,r)}));let d=A;class p{constructor(){s(this,"_data"),s(this,"objects"),this.X=[]}Z(t){return this.$=t,this}tt(t,s){return(new t).Z(s).init()}make(t,s={}){let e=this.tt(t,s);return this.X.push(e),e}init(){return this.st(),this}update(){this.X.forEach((t=>t.update())),this.et()}it(t,s){this.rt(t,s),this.X.forEach((e=>e.it(t,s))),this.ht(t,s)}st(){}et(){}ht(t,s){}rt(t,s){}}class g extends p{constructor(){super(...arguments),s(this,"x",0),s(this,"y",0),s(this,"scale_x",1),s(this,"scale_y",1),s(this,"_current_frame",0),s(this,"__elapsed",0)}get data(){return this.$}get info(){let t=a.info.find((t=>t.name));if(!t)throw`nosprite ${this.nt}`;return t}get tag(){let t=this.info.tags.find((t=>t.name===this.ot));if(!t)throw`notag ${this.nt} ${this.ot}`;return t}get nt(){return this.data.name}get ot(){return this.data.tag||"idle"}ct(t,s){this.x=t,this.y=s}get current_frame(){let{from:t}=this.tag;return this.info.U[this._current_frame+t]}get lt(){return this.data.lt??"c"}get P(){if("tl"===this.lt)return 0;let{R:t}=this.current_frame;return"c"===this.lt||"bc"===this.lt?t/2:0}get H(){if("tl"===this.lt)return 0;let{v:t}=this.current_frame;return"c"===this.lt?t/2:"bc"===this.lt?t:0}ut(t){this.data.tag=t,this._current_frame=0,this.__elapsed=0}et(){let{from:t,to:s}=this.tag,{duration:i}=this.current_frame,r=s-t;this.__elapsed+=1e3*e.delta,this.__elapsed>=i&&(this.__elapsed-=i,this._current_frame===r?this._current_frame=0:this._current_frame+=1)}ht(t,s){let{x:e,y:i,At:r,dt:h}=this;t.q(this,e,i,r,h)}}let w={};const C=class{constructor(){s(this,"_fxs")}fx(t){let s=this.gt[t];if(!s)throw`nosound ${t}`;var e;e=s,console.log(e)}};s(C,"make",(()=>{let t=new C;return t.gt=w,t}));const m=new C,I=class{constructor(t,s,e,i,r=!0){this.x=t,this.y=s,this.w=e,this.wt=i,this.value=r}};s(I,"rect",((t,s,e,i)=>new I(t,s,e,i))),s(I,"hline",((t,s,e)=>new I(t,s,e,1))),s(I,"vline",((t,s,e)=>new I(t,s,1,e)));let Q=I;const E=class{constructor(t){this.grid=t}Ct(t){let s=Math.floor(t.x/8),e=Math.floor(t.y/8),i=Math.floor((t.x+t.w-1)/8),r=Math.floor((t.y+t.wt-1)/8);for(let h=s;h<=i;h++)for(let s=e;s<=r;s++)this.grid[h][s]=t.value}It(t,s,e){let{x:i,y:r,w:h,wt:n}=t;return this.Qt(i+s,r+e,h,n)}Qt(t,s,e=1,i=1){let r=Math.floor(t/8),h=Math.floor(s/8),n=Math.floor((t+e-1)/8),a=Math.floor((s+i-1)/8);if(r<0||n>=40||h<0||a>=23)throw`outbounds ${t} ${s}`;for(t=r;t<=n;t++)for(s=h;s<=a;s++)if(this.grid[t][s])return!0;return!1}};s(E,"make",(()=>{let t=[];for(let e=0;e<40;e++)t.push(new Array(23).fill(!1));let s=new E(t);return s.Ct(Q.hline(0,172,320)),s}));let y=E,k=[u,l];class x extends p{constructor(){super(...arguments),s(this,"grid")}st(){this.grid=y.make()}ht(t){for(let s=0;s<320;s+=8)for(let e=0;e<180;e+=8)this.grid.Qt(s,e)&&t.V(k[(s+e)/8%2],s,e,8,8)}}class f extends p{constructor(){super(...arguments),s(this,"world"),s(this,"solid")}init(){return this.Et=this.make(D),this.yt=this.make(x),this.st(),this}et(){let{grid:t}=this.yt,{kt:s}=this.Et;s.forEach((s=>{for(let i=0;i<3;i++){let i=Math.abs(s.dx),r=Math.sign(s.dx);for(let n=1/3;n<=i;n+=1/3){if(t.It(s,r*n*e.delta,0)){s.dx=0;break}s.x+=r*n*e.delta}let h=Math.abs(s.dy);r=Math.sign(s.dy);for(let n=1/3;n<=h;n+=1/3){if(t.It(s,0,r*n*e.delta)){s.dy=0;break}s.y+=r*n*e.delta}}}))}}class b extends p{constructor(){super(...arguments),s(this,"_w"),s(this,"_h"),s(this,"x"),s(this,"y"),s(this,"dx"),s(this,"dy")}get data(){return this.$}get w(){return this.xt}get wt(){return this.ft}init(){return this.x=this.data.x??0,this.y=this.data.y??0,this.xt=this.data.w,this.ft=this.data.wt,this.dx=0,this.dy=0,super.init()}}class D extends p{get kt(){return this.X}body(t,s={}){return this.make(t,s)}et(){}}class M extends b{constructor(){super(...arguments),s(this,"anim")}get data(){return this.$}init(){return this.q=this.make(g,this.data),super.init()}update(){this.q.x=this.x,this.q.y=this.y,super.update()}}const _=3.6912;class B extends M{et(){n.B("left")?(this.q.At=-1,this.dx=-3.6912):n.B("right")?(this.q.At=1,this.dx=_):this.dx=0}}class J extends p{st(){this.make(S)}et(){n.M("jump")&&m.fx("start")}}const Y=class extends p{st(){this.make(J)}rt(t,s){t.clear(),s.clear()}};s(Y,"make",(()=>(new Y).init()));let K=Y;class W extends p{ht(t,s){s.G("hello",100,50,100)}}class S extends f{st(){this.Et.body(B,{name:"player",x:8,y:8,lt:"bc"}).dy=4,this.make(W)}}!async function(t){await a.load(),function(t){let s=d.make(1920,1080,!1),e=d.make(320,180),r=K.make();i.A({p(){n.update(),r.update()},D(){r.it(e,s)}}),t.appendChild(e.canvas),t.appendChild(s.canvas)}(t)}(document.getElementById("app"));
