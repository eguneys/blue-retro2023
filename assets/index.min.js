var t=Object.defineProperty,s=(s,i,e)=>(((s,i,e)=>{i in s?t(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e})(s,"symbol"!=typeof i?i+"":i,e),e);const i=new class{constructor(){s(this,"ticks_per_second",1e3),s(this,"ticks",0),s(this,"seconds",0),s(this,"delta",0),s(this,"previous_ticks",0),s(this,"previous_seconds",0),s(this,"pause_timer",0)}t(t){t>=this.i&&(this.i=t)}o(t,s=0){let i=this.seconds,e=this.delta;return Math.floor((i-s-e)/t)<Math.floor((i-s)/t)}l(t,s){let i=Math.floor(t)-this.delta;return t>=s&&i<s}u(t,s=0){let i=this.seconds;return h=2*t,(e=i-s)-Math.floor(e/h)*h>=t;var e,h}};const e=new class{constructor(){s(this,"app_time_last"),s(this,"app_time_accumulator",0)}A(t){const s=()=>{t.g()},e=h=>{let n=Math.min(25,h-(this._??h));this._=h,this.p+=n,i.delta=n/i.ticks_per_second,i.i>0?i.i-=i.delta:(i.m=i.k,i.k+=n,i.B=i.seconds,i.seconds+=i.delta,s()),t.M(),requestAnimationFrame(e)};requestAnimationFrame(e)}};const h=new class{constructor(){s(this,"bounds"),s(this,"_click"),s(this,"_click_clear",!0),s(this,"_move"),s(this,"_move_clear",!0)}get click(){return this.v}get move(){return this.C}D(t){this.L=!1,this.C=t}O(t){this.U=!1,this.v=t}P(t){const s=t=>{let s=[t.clientX,t.clientY],{bounds:i}=this;return s[0]-=i.left,s[1]-=i.top,s[0]/=i.width,s[1]/=i.height,s};t.addEventListener("click",(t=>this.O(s(t)))),t.addEventListener("mousemove",(t=>this.D(s(t))));const i=()=>{this.bounds=t.getBoundingClientRect()};document.addEventListener("scroll",i),window.addEventListener("resize",i),i()}update(){this.U?this.v&&(this.U=!1,this.v=void 0):this.v&&(this.U=!0),this.L?this.C&&(this.L=!1,this.C=void 0):this.C&&(this.L=!0)}},n=class{constructor(){s(this,"_btn_pre",!1),s(this,"_btn",0)}get W(){return this.F}get q(){return this.H>0}j(t){this.H="down"===t?1:0}update(){1!==this.H||this.F?this.F=!1:this.F=!0,1===this.H&&(this.H=2)}};s(n,"make",(()=>new n));let r=n;const o=new class{constructor(){s(this,"action_map"),s(this,"key_map"),this.I={jump:r.make(),left:r.make(),right:r.make(),down:r.make(),pickup:r.make(),music:r.make()},this.N={i:"jump",j:"left",k:"down",l:"right",w:"jump",a:"left",s:"down",d:"right",ArrowUp:"jump",ArrowLeft:"left",ArrowDown:"down",ArrowRight:"right",x:"pickup",c:"pickup",Space:"pickup",m:"music"},document.addEventListener("keydown",(t=>{var s;return null==(s=this.I[this.N[t.key]])?void 0:s.j("down")})),document.addEventListener("keyup",(t=>{var s;return null==(s=this.I[this.N[t.key]])?void 0:s.j("up")}))}W(t){return this.I[t].W}q(t){return this.I[t].q}update(){for(let t of Object.keys(this.I))this.I[t].update()}};const l=new class{constructor(){s(this,"image"),s(this,"info")}async load(){var t;this.V=await(t="data:image/png;base64,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",new Promise((s=>{let i=new Image;i.onload=()=>s(i),i.src=t}))),this.info="bounce\n\n0*0*1\n1*1*2\n2*2*3\n3*3*4\n4*4*5\n5*5*6\n6*6*7\n7*7*8\n8*8*9\n\n0*0*16*16*80*0*16*16\n0*0*16*16*96*0*16*16\n0*0*16*16*112*0*16*16\n0*0*16*16*80*16*16*16\n0*0*16*16*96*16*16*16\n0*0*16*16*112*16*16*16\n0*0*16*16*80*32*16*16\n0*0*16*16*96*32*16*16\n0*0*16*16*112*32*16*16\n\n\ndust\n\n0*0*s\n1*1*m\n2*2*l\n\n0*0*32*16*80*48*32*16\n0*0*32*16*80*64*32*16\n0*0*32*16*0*80*32*16\n\n\nfly\n\n0*3*idle\n\n0*0*16*16*32*80*16*16\n0*0*16*16*48*80*16*16\n0*0*16*16*64*80*16*16\n0*0*16*16*80*80*16*16\n\n\nghoul\n\n0*3*idle\n\n0*0*16*16*96*80*16*16\n0*0*16*16*112*80*16*16\n0*0*16*16*112*48*16*16\n0*0*16*16*112*64*16*16\n\n\nplayer\n\n0*1*hit\n2*3*jump\n4*5*attack\n6*7*idle\n8*11*walk\n\n0*0*16*16*0*96*16*16\n0*0*16*16*16*96*16*16\n0*0*16*16*32*96*16*16\n0*0*16*16*48*96*16*16\n0*0*16*16*64*96*16*16\n0*0*16*16*80*96*16*16\n0*0*16*16*96*96*16*16\n0*0*16*16*112*96*16*16\n0*0*16*16*0*112*16*16\n0*0*16*16*16*112*16*16\n0*0*16*16*32*112*16*16\n0*0*16*16*48*112*16*16\n\n\nsun\n\n0*0*idle\n\n0*0*80*80*0*0*80*80".split("\n\n\n").map((t=>{let[s,i,e]=t.split("\n\n");return{name:s,tags:i.split("\n").map((t=>{let[s,i,e]=t.split("*");return{from:parseInt(s),to:parseInt(i),name:e}})),X:e.split("\n").map((t=>{let[s,i,e,h,n,r,o,l]=t.split("*").map((t=>parseInt(t)));return{fx:s,fy:i,K:e,T:h,Y:n,G:r,R:o,J:l,duration:100}}))}}))}},a=class{constructor(t,s,i,e){this.r=t,this.S=s,this.b=i,this.a=e}get css(){return`rgba(${this.r}, ${this.S}, ${this.b}, ${this.a})`}};s(a,"hex",(t=>new a((16711680&t)>>16,(65280&t)>>8,255&t,255))),s(a,"lightpurple",a.hex(11841221)),s(a,"lightblue",a.hex(4293053)),s(a,"background",a.hex(11841221)),s(a,"light",a.hex(15657718)),s(a,"darkblue",a.hex(1586258)),s(a,"darkred",a.hex(11807859)),s(a,"red",a.hex(14569562)),s(a,"green",a.hex(2158244)),s(a,"purple",a.hex(9142708)),s(a,"darkpurple",a.hex(7559539)),s(a,"all",[a.background,a.darkblue,a.light,a.lightblue,a.red,a.darkred,a.green,a.purple]),s(a,"lerp",((t,s,i)=>(i<0&&(i=0),i>1&&(i=1),new a(t.r+(s.r-t.r)*i,t.S+(s.S-t.S)*i,t.b+(s.b-t.b)*i,t.a+(s.a-t.a)*i))));let c=a;const u=class{constructor(t,s){this.canvas=t,this.Z=s}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(t=c.background){let{Z:s}=this;s.clearRect(0,0,this.width,this.height)}$(t,s){let{Z:i}=this;i.save(),i.translate(t,s)}pop(){let{Z:t}=this;t.restore()}rect(t=c.red,s,i,e,h){let{Z:n}=this;n.fillStyle=t.css,n.fillRect(s,i,e,h)}tt(t=c.red,s,i,e,h){let{Z:n}=this;n.strokeStyle=t.css,n.lineWidth=1,n.strokeRect(s+1,i+1,e-2,h-2)}st(t,s,i,e=64,h=c.light,n){let{Z:r}=this,o=r.measureText(t).width;return"c"===n?(s-=o/2,r.textBaseline="middle"):r.textBaseline="alphabetic",r.font=`${e}px 'Courier New', monospace`,r.fillStyle=h.css,r.fillText(t,s,i),o}it(t,s,i,e=1,h=1){let{fx:n,fy:r,Y:o,G:l,R:a,J:c}=t.current_frame,{et:u,ht:d}=t,A=s-n-u,g=i-r-d;this.nt(A,g,o,l,a,c,e,h)}nt(t,s,i,e,h,n,r=1,o=1){let{Z:a}=this,{V:c}=l;a.save();let u=h,d=n,A=u*Math.abs(r),g=d*Math.abs(o);a.scale(Number(r.toFixed(2)),Number(o.toFixed(2))),r<0&&(t*=-1,t-=A),o<0&&(s*=-1,s-=g),a.drawImage(c,i,e,u,d,Math.round(t),Math.round(s),Math.round(A),Math.round(g)),a.restore()}};s(u,"make",((t,s,i=!0)=>{let e=document.createElement("canvas");i&&e.classList.add("pixelated");let h=e.getContext("2d");const n=()=>{e.width=t,e.height=s,h.imageSmoothingEnabled=i};return document.addEventListener("scroll",n,{capture:!0,passive:!0}),window.addEventListener("resize",n,{passive:!0}),n(),new u(e,h)}));let d=u;const A=(t,s,i,e,h,n)=>t<=h&&h<=t+i&&s<=n&&n<=s+e,g=t=>t.split("r").map((t=>parseFloat(t)));class _{constructor(){s(this,"_data"),s(this,"life"),s(this,"objects"),s(this,"pools"),s(this,"_mouses"),this.rt=[],this.ot=[],this.lt=new Map}ct(t){return this.ut=t,this}dt(t,s,i,e,h){let n=((t,s,i,e)=>[t,s,i,e].join("r"))(t,s,i,e);this.lt.set(n,{...h,At:!1})}gt(t,s){return(new t).ct(s).init()}make(t,s={}){let i=this.gt(t,s);return this.ot.push(i),i}_t(t,s={},i=7){let e=this.gt(t,s);return this.ot.push(e),this.rt.push([e,i]),e}remove(t){let s=this.ot.indexOf(t);if(-1===s)throw"noscene rm";this.ot.splice(s,1),s=this.rt.findIndex((([s])=>s===t)),-1!==s&&this.rt.splice(s,1)}init(){return this.wt=0,this.xt(),this}update(){var t,s,e;if(0===this.wt&&this.ft(),this.ot.forEach((t=>t.update())),this.wt+=i.delta,this.rt.slice(0).forEach((([t,s])=>{let i=this.rt.filter((s=>s[0].constructor.name===t.constructor.name));if(i.length>s){let t=i[0][0];this.remove(t)}})),h.click){let s=320*h.click[0],i=180*h.click[1];for(let[e,h]of this.lt)A(...g(e),s,i)&&(null==(t=h.O)||t.call(h))}if(h.move){let t=320*h.move[0],i=180*h.move[1];for(let[h,n]of this.lt)A(...g(h),t,i)?n.At||(n.At=!0,null==(s=n.yt)||s.call(n)):(n.At&&(null==(e=n.kt)||e.call(n)),n.At=!1)}this.bt()}Bt(t,s){this.Mt(t,s),this.ot.forEach((i=>i.Bt(t,s))),this.vt(t,s)}xt(){}ft(){}bt(){}vt(t,s){}Mt(t,s){}}class w extends _{constructor(){super(...arguments),s(this,"x",0),s(this,"y",0),s(this,"scale_x",1),s(this,"scale_y",1),s(this,"_current_frame",0),s(this,"__elapsed",0)}get data(){return this.ut}get info(){let t=l.info.find((t=>t.name===this.Ct));if(!t)throw`nosprite ${this.Ct}`;return t}get tag(){let t=this.info.tags.find((t=>t.name===this.Dt));if(!t)throw`notag ${this.Ct} ${this.Dt}`;return t}get Ct(){return this.data.name}get Dt(){return this.data.tag||"idle"}Qt(t,s){this.x=t,this.y=s}get current_frame(){let{from:t}=this.tag;return this.info.X[this._current_frame+t]}get Lt(){return this.data.Lt??"c"}get et(){if("tl"===this.Lt)return 0;let{K:t}=this.current_frame;return"c"===this.Lt||"bc"===this.Lt?t/2:0}get ht(){if("tl"===this.Lt)return 0;let{T:t}=this.current_frame;return"c"===this.Lt?t/2:"bc"===this.Lt?t:0}zt(t){this.data.tag=t,this._current_frame=0,this.__elapsed=0}bt(){let{from:t,to:s}=this.tag,{duration:e}=this.current_frame,h=s-t;this.__elapsed+=1e3*i.delta,this.__elapsed>=e&&(this.__elapsed-=e,this._current_frame===h?this._current_frame=0:this._current_frame+=1)}vt(t,s){let{x:i,y:e,Et:h,Ot:n}=this;t.it(this,i,e,h,n)}}function x(t,s,i){return Math.max(Math.min(t,i),s)}const f=t=>Math.sin(t),p=t=>(t%6.28-3.14)/6.28,m=t=>x(1e3*Math.sin(t),-1,1);let y,k;y=new AudioContext,k=y.sampleRate;let b=[["intro",[[0,2,3,5,7,12],1.3],0]],B=[["start",.737,t=>(t*=-999)&&.6*f(t/(20+f(t/900+f(t/440+f(t/222)))-t/400))],["click",.737,t=>(t*=-999)&&.6*f(t/(20+f(t/900+f(t/440+f(t/222)))-t/400))],["tense",1.5,t=>.1*(.5*m(t/800)+.5)*p(t/110)],["short",.4,t=>.03*p(t/4)],["start2",3.321,t=>m(t/(20+t/100))+Math.random()/t*210-6*f(33.22*t)],["sqr",1.1415,t=>m(t/(111-t/54.21))]];const M=async t=>{async function s(){return new Promise((t=>setTimeout(t,0)))}function i(s){t(s)}let e,h,n,r,o,l,a={},c={},u=!0;async function d(t,i){let e=y.createBuffer(1,k*t,k),h=e.getChannelData(0),n=e.length;for(let s=0;s<n;s++)h[s]=i(44100*s/k)*(1-s/n);return await s(),e}async function A([t,i],e){const h=[],n=[],o=[4,2,.5,3,4][e],l=[1,.5,.25,2,2][e++],a=[-15,-20,-19,-12];n.push([e*e*3*.5%2,e%2],[.5*(e*e*3+9*e)%2,(e+1)%2],[.5*(e*e*2+11*e)%2,(e+1)%2]);for(let s=0;s<3;s++){const i=8*s,n=[0,3,-5][s];for(let t=0;t<8;t++)h.push([a[(7*e+2*s+(t>>1)+t*t*3)%4]+n,t+i,6,1]);for(let r=0;r<8/l;r++)(r+r*r+s+3*e)%7<4&&h.push([-3+n+t[(r+r*r*2+s*s*2+e)%t.length],r*l+i,o,2])}const c=y.createBuffer(1,8*k*3*i,k),u=c.getChannelData(0);for(let r=0;r<h.length;r++){let t,e,n,o;[t,e,n,o]=h[r];const l=Math.floor(e*i*k),a=n*i*k;for(let s=0;s<a;s++){let i=0;const e=s/a;i+=1==o?2*x(f(s/(6*2**(-t/12)*2*2)+f(s/8e3))*(44*Math.exp(23*-e)+1),-1,1):7*p(s/(24.18*2**(-t/12)*2)),u[l+s]+=i*Math.min(e*Math.exp(-e*(10+7*o))*100,1)/500}await s()}for(let d=0;d<44;d+=2){for(let t=0;t<n.length;t++){let s,e;[e,s]=n[t];const h=Math.floor(.5*k*s),o=Math.floor((e+d)*k*i);for(let t=0;t<.1*k;t++)u[t+o]+=r[t+h]}await s()}return c}function g(t){let s=e;t&&(e=y.createBufferSource(),e.buffer=t,e.loop=!0,e.connect(u?o:l),e.start()),setTimeout((()=>{null==s||s.stop()}),700),o.gain.setTargetAtTime(u?1:0,y.currentTime,.5),l.gain.setTargetAtTime(u?0:1,y.currentTime,.5),u=!u}return await async function(){let t=B.length+b.length+1;for(let s in B){let[e,h,n]=B[s],r=await d(h,n);i((Number(s)+1)/t),a[e]=r}n=y.createBuffer(1,k,k),r=n.getChannelData(0);const e=.1*k;for(let s=0;s<e;s++)r[s]+=.01*(f(s/(70+s/300))+Math.random()/3)*(1-s/e),r[Math.floor(.5*k)+s]+=.01*Math.random()*(1-s/e);await s(),h=y.createBuffer(1,3*k,k);const u=h.getChannelData(0);for(let s=0;s<3*k;s++){const t=s/k;u[s]=x(Math.sin(s/120)*(10+10*f(s/1e4+t*t*t*4)),-1,1)*t/50}await s();for(let s in b){let[e,h,n]=b[s],r=await A(h,n);i((B.length+(Number(s)+1))/t),c[e]=r}o=new GainNode(y),o.connect(y.destination),l=new GainNode(y),l.connect(y.destination)}(),[t=>function(t){let s=y.createBufferSource();s.buffer=t,s.connect(y.destination),s.start()}(a[t]),t=>function(t){if(!t)return void g();if(!c[t])throw`nomusic ${t}`;g(c[t])}(t)]},v=class{constructor(){s(this,"_loaded",!1),s(this,"_fx"),s(this,"_music"),s(this,"_music_onoff",!0),s(this,"_last_music")}get loaded(){return this.Ut}async load(t){this.loaded||([this.Pt,this.Wt]=await M(t),this.Ut=!0,t(1))}get Ft(){return this._music_onoff}set Ft(t){var s,i;this._music_onoff=t,this._music_onoff?null==(i=this.Wt)||i.call(this,this.qt):null==(s=this.Wt)||s.call(this)}fx(t){var s;null==(s=this.Pt)||s.call(this,t)}Ht(t){var s;this.qt=t,this.Ft&&(null==(s=this.Wt)||s.call(this,t))}};s(v,"make",(()=>new v));const C=v.make();function D(t,s){return s<<8*(4-t)}const Q=[[[0,3,8,12],[3,16,9,12],[16,20,10,12]]],L=0,z={[L]:!0,2:!0};function E(t,s,i,e){return D(1,t)|D(2,s)|D(3,i)|D(4,e)}const O={[E(1,2,1,2)]:[4,0],[E(1,2,2,2)]:[1,0],[E(2,2,2,2)]:[3,2],[E(2,L,2,2)]:[0,2],[E(2,2,2,L)]:[3,2],[E(2,L,2,L)]:[3,2]},U={2:O,3:O},P=[0,0],W={2:P,3:P,1:[3,1]},F=class{constructor(t){s(this,"sx"),s(this,"sy"),this.cluster=t}get R(){return 16}get J(){return 16}get jt(){return z[this.cluster]}It(t){var s;let[i,e]=(null==(s=U[this.cluster])?void 0:s[t])??W[this.cluster];this.Y=16*i,this.G=16*e}};s(F,"cluster",(t=>new F(t)));let q=F;const H=16,j=class{constructor(t){this.grid=t}Nt(){!function(t){const s=t.length,i=t[0].length;for(let e=0;e<s;e++)for(let s=0;s<i;s++){let i=0;[[e,s-1],[e-1,s],[e+1,s],[e,s+1]].forEach((([s,e],h)=>{var n,r;i|=D(h+1,(null==(r=null==(n=t[s])?void 0:n[e])?void 0:r.cluster)??L)})),t[e][s].It(i)}}(this.grid)}Vt(t){let s=Math.floor(t.x/H),i=Math.floor(t.y/H),e=Math.floor((t.x+t.w-1)/H),h=Math.floor((t.y+t.h-1)/H);for(let n=s;n<=e;n++)for(let s=i;s<=h;s++)this.grid[n][s]=q.cluster(t.cluster)}Xt(t,s,i){let{x:e,y:h,w:n,h:r}=t,o=n/2;try{return this.Kt(e-o+s,h-r+i,n,r)}catch(l){return!0}}Kt(t,s,i=1,e=1){let h=t/H,n=s/H,r=(t+i-1)/H,o=(s+e-1)/H;if(h<0||r>=20||n<0||o>=12)throw`outbounds ${t} ${s}`;for(t=h;t<=r;t++)for(s=n;s<=o;s++)if(t=Math.floor(t),s=Math.floor(s),this.grid[t][s].jt)return!0;return!1}get Tt(){let t=[];for(let s=0;s<20;s++)for(let i=0;i<12;i++)t.push([s*H,i*H,this.grid[s][i]]);return t}};s(j,"make",(()=>{let t=[];for(let i=0;i<=20;i++)t.push(new Array(12).fill(q.cluster(1)));Q.forEach((s=>{s.forEach((s=>{let[i,e,h,n]=s;for(;h<n;){let s=i;for(;s<e;)t[Math.floor(s)][Math.floor(h)]=q.cluster(2),s++;h++}}))}));let s=new j(t);return s.Nt(),s}));let I=j,N=[c.red,c.darkred];class V extends _{constructor(){super(...arguments),s(this,"grid"),s(this,"_anims_by_tile"),s(this,"debug",!1)}xt(){this.grid=I.make(),this.Yt=new Map}bt(){i.o(.86543)&&([N[1],N[0]]=[N[0],N[1]])}vt(t){this.grid.Tt.forEach((([s,i,e])=>{if(this.debug)e.jt&&t.tt(N[(s+i)/H%2],s,i,H,H);else{let h=s,n=i,{Y:r,G:o,R:l,J:a}=e;t.nt(h,n,r,o,l,a)}}))}}const X=((t=1)=>()=>{var s=1e4*Math.sin(t++);return s-Math.floor(s)})();function K(t){return t[function(t,s=X){return Math.floor(s()*t)}(t.length)]}const T=class{get code(){return"hello"}get Gt(){return 0}};s(T,"make",(()=>new T)),s(T,"from_code",(t=>new T));let Y=T;[new Y,new Y].every((t=>Y.from_code(t.code).code===t.code))?console.log("codes ok"):console.log("codes wrong");const G=t=>t/320*1920,R=t=>t/180*1080,J=t=>t/1920*320,S=t=>t/1080*180,Z=1e-5,$=2.58002,tt=4.1812;class st extends _{constructor(){super(...arguments),s(this,"world"),s(this,"solid")}init(){return this.Rt=this.make(et),this.jt=this.make(V),super.init()}bt(){let{grid:t}=this.jt,{Jt:s}=this.Rt;s.forEach((s=>{for(let e=3;e>=1;e--){let h=2*e/9;{let e=Math.abs(s.dx),n=Math.sign(s.dx);for(let r=h;r<=e;r+=h){let e=.5*n*r*Math.sqrt(i.delta);if(t.Xt(s,e,0)){s.St=n,s.dx=0;break}s.St=0,s.x+=e}}let n=tt*s.Zt,r=0;{let e=Math.abs(s.dy),o=Math.sign(s.dy);for(let l=h;l<=e;l+=h){let a=.5*o*l*Math.sqrt(i.delta);if(t.Xt(s,0,a)){s.$t=o,s.dy=0,r=0;break}s.$t=0,s.y+=a,r=1-o*((l-h)/(e-h));{let t=.044311*n*Math.sqrt(r),e=1;s.dy+=e*t*i.delta}}}{let e=.877*n,r=1;for(let n=h;n<=e;n+=h){let e=.5*r*n*Math.sqrt(i.delta);if(t.Xt(s,0,e)){s.$t=r,s.dy=0;break}s.$t=0,s.y+=e}}}}))}}class it extends _{constructor(){super(...arguments),s(this,"_scale_G"),s(this,"variance"),s(this,"lerp_x"),s(this,"lerp_y"),s(this,"world"),s(this,"collide_v"),s(this,"collide_h"),s(this,"_w"),s(this,"_h"),s(this,"x"),s(this,"y"),s(this,"dx"),s(this,"dy")}get data(){return this.ut}ts(t,s={}){return this.Rt.ss(this,t,s)}get es(){return this.$t<0}get hs(){return this.$t>0}get ns(){return this.St<0}get rs(){return this.St>0}get w(){return this.os}get h(){return this.ls}init(){return this.x=this.data.x??0,this.y=this.data.y??0,this.os=this.data.w,this.ls=this.data.h,this.dx=0,this.dy=0,this.Zt=this.data.cs??1,this.us=nt,this.ds=void 0,this.As=void 0,super.init()}update(){if(this.ds){let[t,s,e]=this.ds;e<=Z?this.ds=void 0:(this.dx=this.dx+(t-this.dx)*(1-e/s),this.ds[2]-=i.delta)}if(this.As){let[t,s,e]=this.As;e<=Z?this.As=void 0:(this.dy=this.dy+(t-this.dy)*(1-e/s),this.As[2]-=i.delta)}super.update()}}class et extends _{get Jt(){return this.ot}body(t,s={}){let i=this.make(t,s);return i.Rt=this,i}ss(t,s,i={}){let e=this.Jt.indexOf(t);if(-1===e)throw"nobody";return this.Jt.splice(e,1),this.body(s,i)}}class ht extends it{constructor(){super(...arguments),s(this,"anim")}get data(){return this.ut}init(){return this.it=this.make(w,this.data),super.init()}update(){this.it.x=this.x,this.it.y=this.y,super.update()}}const nt=.6234;function rt(t=1,s=nt){let i=-t,e=+t;return(X()*(e-i)+i)*s}function ot(t,s=nt){return Math.floor(t/2+rt(t/2,s)+1)}function lt(t,s=nt){return t/2+rt(t/2,s)}class at extends ht{bt(){let{us:t}=this;if(i.o(.1764)){let s=rt(3.222,t);this.ds=[s,.2,.2]}if(i.o(.242)){let s=rt(3.323,t);this.As=[s,.2,.2]}}}class ct extends ht{constructor(){super(...arguments),s(this,"_pre_grounded",!1)}get gs(){return this.it.Et}bt(){!this.hs||!i.o(rt(3))&&this._s||this._t(Bt,{x:this.x-8*this.gs,y:this.y-8},4),this._s=this.hs,o.q("left")?(this.it.Et=-1,this.dx=-$):o.q("right")?(this.it.Et=1,this.dx=$):this.dx=0,o.q("jump")&&this.hs&&(this.dy=-5.43556)}}class ut extends _{get data(){return this.ut}vt(t){let{color:s,x:i,y:e,w:h,h:n}=this.data;t.tt(s,i,e,h,n)}}class dt extends _{constructor(){super(...arguments),s(this,"_lerp_to"),s(this,"_lerp_t",0)}get data(){return this.ut}lerp(t,s=.142){this.ws=t,this.xs=s}bt(){if(this.xs>0){let t=1-this.xs/.2;this.data.color=c.lerp(this.data.color,this.ws,t),this.xs-=i.delta,this.xs<0&&(this.xs=0)}}vt(t){let{color:s,x:i,y:e,w:h,h:n}=this.data;t.rect(s,i,e,h,n)}}class At extends _{constructor(){super(...arguments),s(this,"hovering",!1),s(this,"click_t",0),s(this,"w",60),s(this,"h",22),s(this,"bg")}get data(){return this.ut}get x(){return this.data.x}get y(){return this.data.y}xt(){let{w:t,h:s}=this;this.fs=this.make(dt,{color:c.darkblue,x:3,y:2,w:t,h:s}),this.make(ut,{color:c.lightblue,x:3,y:2,w:t,h:s}),this.make(bt,{x:G(t/2-2),y:R(s/2+2),size:74,text:this.data.text,align:"c"});let i=this;this.dt(this.x,this.y,this.w,this.h,{O(){C.fx("click"),i.ps=.073454,i.fs.lerp(c.red,i.ps)},yt(){i.fs.lerp(c.lightblue)},kt(){i.fs.lerp(c.darkblue)}})}bt(){this.ps>0&&(this.ps-=i.delta,this.ps<=0&&(this.ps=0,this.fs.lerp(c.lightblue,.345)))}Mt(t,s){t.$(this.data.x,this.data.y),s.$(G(this.data.x),R(this.data.y))}vt(t,s){t.pop(),s.pop()}}class gt extends _{constructor(){super(...arguments),s(this,"align"),s(this,"blue_text"),s(this,"retro_text"),s(this,"music_text"),s(this,"music_ontext")}get data(){return this.ut}xt(){this.align=[],this.make(dt,{color:c.darkblue,x:3,y:2,w:84,h:42}),this.make(ut,{color:c.lightblue,x:3,y:2,w:84,h:42}),this.make(ut,{color:c.red,x:2,y:1,w:86,h:44}),this.ys=this.make(bt,{x:50,y:100,size:74,text:"blue"}),this.ks=this.make(bt,{x:150,y:100,size:74,text:"retro"});let t=this;this.dt(J(50),S(26),J(500),S(74),{O(){t.data.bs()},yt(){t.ys.color=c.lightblue,t.ks.color=c.purple},kt(){t.ys.color=c.light,t.ks.color=c.light}}),this.align.push({margin:89,h:[this.ys,this.ks]}),this.make(kt,{x:50,y:170,size:54,text:"1 undescent"}),this.Bs=this.make(bt,{x:50,y:228,size:54,text:"music"}),this.Ms=this.make(bt,{x:280,y:228,size:54,text:"on"}),this.dt(J(50),S(174),J(280),S(54),{O(){C.Ft=!C.Ft,t.vs()},yt(){t.Ms.color=c.red},kt(){t.Ms.color=c.light}}),this.make(At,{x:250,y:4,text:"Right"}),this.make(At,{x:180,y:4,text:"Left"}),this.make(At,{x:220,y:30,text:"Jump"}),t.vs()}vs(){C.Ft?this.Ms.text="on":this.Ms.text="off"}bt(){o.W("music")&&(C.Ft=!C.Ft,this.vs()),this.align.forEach((t=>{var s;let i=t.margin??0;null==(s=t.h)||s.reduce(((t,s)=>(s.x=t.x+t.width+i,s)))}))}}class _t extends _{constructor(){super(...arguments),s(this,"parent")}Cs(t,s={}){let i=this.make(t,s);return i.parent=this,i}Ds(t,s={}){var i,e;null==(i=this.parent)||i.remove(this),null==(e=this.parent)||e.Cs(t,s)}}class wt extends _t{xt(){C.Ht("intro"),this.make(Ct);let t=this;this.make(gt,{bs(){t.Ds(ft)}})}}const xt=Y.make();class ft extends _t{constructor(){super(...arguments),s(this,"texts"),s(this,"code_text")}xt(){C.Ft=!1,this.make(dt,{color:c.green,x:0,y:0,w:320,h:180}),this.make(bt,{color:c.lightpurple,x:-1070,y:1020,size:9e3,text:"E"});let t=480;this.Qs=this.make(bt,{color:c.darkpurple,x:t,y:100,size:40,text:"please send your secret code wait_x2_not in the end to me ;)"}),this.Ls=[this.make(bt,{color:c.darkpurple,x:t,y:100,size:90,text:"thanks for playing"}),this.Qs,this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"art twitter.com/_V3X3D"}),this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"music github.com/arikwex"}),this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"author twitter.com/eguneys"}),this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:120,text:"Mucho Gracias <3"}),this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:80,text:"Check out my PostMortem too!"}),this.make(bt,{color:c.darkpurple,x:t,y:1e3,size:120,text:"bb"})];let s=this;this.dt(0,0,320,180,{O(){s.Ds(pt)}})}bt(){this.Ls[0].y+=200*i.delta,this.Ls[0].y>1080*this.Ls.length-100&&(this.Qs.text=this.Qs.text.replace("wait_x2_not",xt.code)),this.Ls[0].y%=1080*this.Ls.length-100,this.Ls.reduce(((t,s)=>(s.y=t.y-t.height-777,s)))}}class pt extends _t{constructor(){super(...arguments),s(this,"begin_text1"),s(this,"begin_text2")}ft(){}xt(){this.make(dt,{color:c.darkblue,x:0,y:0,w:320,h:180}),this.make(bt,{color:c.lightblue,x:-250,y:1020,size:6e3,text:"V"}),this.make(bt,{x:50,y:170,size:112,text:"2 minute ssir..",color:c.light}),this.make(bt,{x:960,y:540,size:112,text:"blue",color:c.light}),this.make(bt,{x:1280,y:540,size:112,text:"retro",color:c.light}),this.make(bt,{x:640,y:900,size:112,text:"by",color:c.light}),this.make(kt,{x:840,y:900,size:112,text:"eguneys",color:c.light}),this.zs=this.make(bt,{x:0,y:1030,size:62,text:"click to begin",color:c.light}),this.Es=this.make(bt,{x:0,y:1030,size:62,text:"click to begin",color:c.light}),C.load((t=>{let s=1===t?"click to begin":`loading sounds ${100*t}%`;this.zs.text=s,this.Es.text=s,console.log(s)}));let t=this;this.dt(0,0,320,180,{O(){C.loaded&&t.Ds(wt)}})}bt(){this.zs.x+=300*i.delta,this.Es.x+=300*i.delta,this.zs.x+this.zs.width>1920&&(this.Es.x=this.zs.x-1920),this.Es.x+this.Es.width>1920&&(this.zs.x=this.Es.x-1920)}}const mt=class extends _t{xt(){this.Cs(wt)}Mt(t,s){t.clear(),s.clear()}};s(mt,"make",(()=>(new mt).init()));let yt=mt;class kt extends _{constructor(){super(...arguments),s(this,"_width",0),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color"),s(this,"lc")}get data(){return this.ut}get width(){return this.Os}get height(){return this.size}xt(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??c.light,this.Us=[]}bt(){i.o(.2)&&(this.Us=this.text.split("").map((t=>[t,K(c.all)])))}vt(t,s){this.Os=0,this.Us.map((([t,i])=>{let e=s.st(t,this.x+this.Os,this.y,this.size,i);this.Os+=e}))}}class bt extends _{constructor(){super(...arguments),s(this,"_width",0),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color")}get data(){return this.ut}get width(){return this.Os}get height(){return this.size}xt(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??c.light}vt(t,s){this.Os=s.st(this.text,this.x,this.y,this.size,this.color,this.data.align)}}class Bt extends _{get data(){return this.ut}xt(){this.make(w,{name:"bounce",tag:`${5+Math.floor(rt(4))}`}).Qt(this.data.x,this.data.y)}}class Mt extends _{xt(){for(let t=0;t<16+rt(8);t++){this.make(w,{name:"dust",tag:"s"}).Qt(90+rt(320),rt(180))}}}class vt extends _{constructor(){super(...arguments),s(this,"world"),s(this,"ones")}get data(){return this.ut}xt(){this.Rt=this.data.Rt,this.Ps=[]}bt(){if(i.o(ot(ot(3.2)+1))){let t=at,s={name:"fly",x:60+ot(190),y:30+ot(60),w:16,h:16,cs:.03+lt(.3),Lt:"bc"};if(this.Ps.length<2||this.Ps.length<ot(2+ot(6)))this.Ps.push(this.Rt.body(t,s));else{let i=this.Ps.shift();i&&this.Ps.push(i.ts(t,s))}}}}class Ct extends st{xt(){this.make(Mt),this.make(vt,{Rt:this.Rt}),this.Rt.body(ct,{name:"player",x:8,y:80,w:16,h:16,Lt:"bc"})}}!async function(t){await l.load(),function(t){let s=d.make(1920,1080,!1),i=d.make(320,180),n=yt.make();e.A({g(){h.update(),o.update(),n.update()},M(){n.Bt(i,s)}}),t.appendChild(i.canvas),t.appendChild(s.canvas),h.P(t)}(t)}(document.getElementById("app"));
