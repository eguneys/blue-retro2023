var t=Object.defineProperty,s=(s,i,e)=>(((s,i,e)=>{i in s?t(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e})(s,"symbol"!=typeof i?i+"":i,e),e);const i=new class{constructor(){s(this,"ticks_per_second",1e3),s(this,"ticks",0),s(this,"seconds",0),s(this,"delta",0),s(this,"previous_ticks",0),s(this,"previous_seconds",0),s(this,"pause_timer",0)}_$pause_for$_(t){t>=this._$pause_timer$_&&(this._$pause_timer$_=t)}_$on_interval$_(t,s=0){let i=this.seconds,e=this.delta;return Math.floor((i-s-e)/t)<Math.floor((i-s)/t)}_$on_time$_(t,s){let i=Math.floor(t)-this.delta;return t>=s&&i<s}_$between_interval$_(t,s=0){let i=this.seconds;return h=2*t,(e=i-s)-Math.floor(e/h)*h>=t;var e,h}};const e=new class{constructor(){s(this,"app_time_last"),s(this,"app_time_accumulator",0)}_$run$_(t){const s=()=>{t._$on_update$_()},e=h=>{let r=Math.min(25,h-(this._$app_time_last$_??h));this._$app_time_last$_=h,this._$app_time_accumulator$_+=r,i.delta=r/i.ticks_per_second,i._$pause_timer$_>0?i._$pause_timer$_-=i.delta:(i._$previous_ticks$_=i._$ticks$_,i._$ticks$_+=r,i._$previous_seconds$_=i.seconds,i.seconds+=i.delta,s()),t._$on_render$_(),requestAnimationFrame(e)};requestAnimationFrame(e)}};const h=new class{constructor(){s(this,"bounds"),s(this,"_click"),s(this,"_click_clear",!0),s(this,"_move"),s(this,"_move_clear",!0)}get click(){return this._$_click$_}get move(){return this._$_move$_}_$on_move$_(t){this._$_move_clear$_=!1,this._$_move$_=t}_$on_click$_(t){this._$_click_clear$_=!1,this._$_click$_=t}_$listen$_(t){const s=t=>{let s=[t.clientX,t.clientY],{bounds:i}=this;return s[0]-=i.left,s[1]-=i.top,s[0]/=i.width,s[1]/=i.height,s};t.addEventListener("click",(t=>this._$on_click$_(s(t)))),t.addEventListener("mousemove",(t=>this._$on_move$_(s(t))));const i=()=>{this.bounds=t.getBoundingClientRect()};document.addEventListener("scroll",i),window.addEventListener("resize",i),i()}update(){this._$_click_clear$_?this._$_click$_&&(this._$_click_clear$_=!1,this._$_click$_=void 0):this._$_click$_&&(this._$_click_clear$_=!0),this._$_move_clear$_?this._$_move$_&&(this._$_move_clear$_=!1,this._$_move$_=void 0):this._$_move$_&&(this._$_move_clear$_=!0)}},r=class{constructor(){s(this,"_btn_pre",!1),s(this,"_btn",0)}get _$btnp$_(){return this._$_btn_pre$_}get _$btn$_(){return this._$_btn$_>0}_$act$_(t){this._$_btn$_="down"===t?1:0}update(){1!==this._$_btn$_||this._$_btn_pre$_?this._$_btn_pre$_=!1:this._$_btn_pre$_=!0,1===this._$_btn$_&&(this._$_btn$_=2)}};s(r,"make",(()=>new r));let n=r;const o=new class{constructor(){s(this,"action_map"),s(this,"key_map"),this._$action_map$_={jump:n.make(),left:n.make(),right:n.make(),down:n.make(),pickup:n.make(),music:n.make()},this._$key_map$_={i:"jump",j:"left",k:"down",l:"right",w:"jump",a:"left",s:"down",d:"right",ArrowUp:"jump",ArrowLeft:"left",ArrowDown:"down",ArrowRight:"right",x:"pickup",c:"pickup"," ":"pickup",m:"music"},document.addEventListener("keydown",(t=>{var s;return null==(s=this._$action_map$_[this._$key_map$_[t.key]])?void 0:s._$act$_("down")})),document.addEventListener("keyup",(t=>{var s;return null==(s=this._$action_map$_[this._$key_map$_[t.key]])?void 0:s._$act$_("up")}))}_$btnp$_(t){return this._$action_map$_[t]._$btnp$_}_$btn$_(t){return this._$action_map$_[t]._$btn$_}update(){for(let t of Object.keys(this._$action_map$_))this._$action_map$_[t].update()}};const l=new class{constructor(){s(this,"image"),s(this,"info")}async load(){var t;this._$image$_=await(t="data:image/png;base64,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",new Promise((s=>{let i=new Image;i.onload=()=>s(i),i.src=t}))),this.info="bounce\n\n0*0*1\n1*1*2\n2*2*3\n3*3*4\n4*4*5\n5*5*6\n6*6*7\n7*7*8\n8*8*9\n\n0*0*16*16*80*0*16*16\n0*0*16*16*96*0*16*16\n0*0*16*16*112*0*16*16\n0*0*16*16*80*16*16*16\n0*0*16*16*96*16*16*16\n0*0*16*16*112*16*16*16\n0*0*16*16*80*32*16*16\n0*0*16*16*96*32*16*16\n0*0*16*16*112*32*16*16\n\n\ndust\n\n0*0*s\n1*1*m\n2*2*l\n\n0*0*32*16*80*48*32*16\n0*0*32*16*80*64*32*16\n0*0*32*16*0*80*32*16\n\n\nfly\n\n0*3*idle\n\n0*0*16*16*32*80*16*16\n0*0*16*16*48*80*16*16\n0*0*16*16*64*80*16*16\n0*0*16*16*80*80*16*16\n\n\nghoul\n\n0*3*idle\n\n0*0*16*16*96*80*16*16\n0*0*16*16*112*80*16*16\n0*0*16*16*112*48*16*16\n0*0*16*16*112*64*16*16\n\n\nplayer\n\n0*1*hit\n2*3*jump\n4*5*attack\n6*7*idle\n8*11*walk\n\n0*0*16*16*0*96*16*16\n0*0*16*16*16*96*16*16\n0*0*16*16*32*96*16*16\n0*0*16*16*48*96*16*16\n0*0*16*16*64*96*16*16\n0*0*16*16*80*96*16*16\n0*0*16*16*96*96*16*16\n0*0*16*16*112*96*16*16\n0*0*16*16*0*112*16*16\n0*0*16*16*16*112*16*16\n0*0*16*16*32*112*16*16\n0*0*16*16*48*112*16*16\n\n\nsun\n\n0*0*idle\n\n0*0*80*80*0*0*80*80".split("\n\n\n").map((t=>{let[s,i,e]=t.split("\n\n");return{name:s,tags:i.split("\n").map((t=>{let[s,i,e]=t.split("*");return{from:parseInt(s),to:parseInt(i),name:e}})),_$packs$_:e.split("\n").map((t=>{let[s,i,e,h,r,n,o,l]=t.split("*").map((t=>parseInt(t)));return{fx:s,fy:i,_$fw$_:e,_$fh$_:h,_$sx$_:r,_$sy$_:n,_$sw$_:o,_$sh$_:l,duration:100}}))}}))}},a=class{constructor(t,s,i,e){this.r=t,this._$g$_=s,this.b=i,this.a=e}get css(){return`rgba(${this.r}, ${this._$g$_}, ${this.b}, ${this.a})`}};s(a,"hex",(t=>new a((16711680&t)>>16,(65280&t)>>8,255&t,255))),s(a,"lightpurple",a.hex(11841221)),s(a,"lightblue",a.hex(4293053)),s(a,"background",a.hex(11841221)),s(a,"light",a.hex(15657718)),s(a,"darkblue",a.hex(1586258)),s(a,"darkred",a.hex(11807859)),s(a,"red",a.hex(14569562)),s(a,"lightred",a.hex(14569562)),s(a,"green",a.hex(2158244)),s(a,"purple",a.hex(9142708)),s(a,"darkpurple",a.hex(7559539)),s(a,"darkgreen",a.hex(44683)),s(a,"grey",a.hex(13488870)),s(a,"white",a.hex(15657718)),s(a,"all",[a.background,a.darkblue,a.light,a.lightblue,a.red,a.darkred,a.green,a.purple]),s(a,"lerp",((t,s,i)=>(i<0&&(i=0),i>1&&(i=1),new a(t.r+(s.r-t.r)*i,t._$g$_+(s._$g$_-t._$g$_)*i,t.b+(s.b-t.b)*i,t.a+(s.a-t.a)*i))));let c=a;const u=class{constructor(t,s){this.canvas=t,this._$ctx$_=s}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(t=c.background){let{_$ctx$_:s}=this;s.clearRect(0,0,this.width,this.height)}_$push_xy$_(t,s){let{_$ctx$_:i}=this;i.save(),i.translate(t,s)}pop(){let{_$ctx$_:t}=this;t.restore()}rect(t=c.red,s,i,e,h){let{_$ctx$_:r}=this;r.fillStyle=t.css,r.fillRect(s,i,e,h)}_$srect$_(t=c.red,s,i,e,h){let{_$ctx$_:r}=this;r.strokeStyle=t.css,r.lineWidth=1,r.strokeRect(s+1,i+1,e-2,h-2)}_$str$_(t,s,i,e=64,h=c.light,r){let{_$ctx$_:n}=this,o=n.measureText(t).width;return"c"===r?(s-=o/2,n.textBaseline="middle"):n.textBaseline="alphabetic",n.font=`${e}px 'Courier New', monospace`,n.fillStyle=h.css,n.fillText(t,s,i),o}_$anim$_(t,s,i,e=1,h=1){let{fx:r,fy:n,_$sx$_:o,_$sy$_:l,_$sw$_:a,_$sh$_:c}=t.current_frame,{_$origin_x$_:u,_$origin_y$_:d}=t,x=s-r-u,A=i-n-d;this._$spr$_(x,A,o,l,a,c,e,h)}_$spr$_(t,s,i,e,h,r,n=1,o=1){let{_$ctx$_:a}=this,{_$image$_:c}=l;a.save();let u=h,d=r,x=u*Math.abs(n),A=d*Math.abs(o);a.scale(Number(n.toFixed(2)),Number(o.toFixed(2))),n<0&&(t*=-1,t-=x),o<0&&(s*=-1,s-=A),a.drawImage(c,i,e,u,d,Math.round(t),Math.round(s),Math.round(x),Math.round(A)),a.restore()}};s(u,"make",((t,s,i=!0)=>{let e=document.createElement("canvas");i&&e.classList.add("pixelated");let h=e.getContext("2d");const r=()=>{e.width=t,e.height=s,h.imageSmoothingEnabled=i};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new u(e,h)}));let d=u;const x=(t,s,i,e,h,r)=>t<=h&&h<=t+i&&s<=r&&r<=s+e,A=t=>t.split("r").map((t=>parseFloat(t)));class g{constructor(){s(this,"_data"),s(this,"life"),s(this,"objects"),s(this,"pools"),s(this,"_mouses"),s(this,"_scheds"),this._$pools$_=[],this._$objects$_=[],this._$_mouses$_=new Map,this._scheds=[]}_$_set_data$_(t){return this._$_data$_=t,this}_$add_mouse$_(t,s,i,e,h){let r=((t,s,i,e)=>[t,s,i,e].join("r"))(t,s,i,e);this._$_mouses$_.set(r,{...h,_$_hovering$_:!1})}_$sched$_(t,s){this._scheds.push([t,s])}_$_make$_(t,s){return(new t)._$_set_data$_(s).init()}make(t,s={}){let i=this._$_make$_(t,s);return this._$objects$_.push(i),i}_$pool$_(t,s={},i=7){let e=this._$_make$_(t,s);return this._$objects$_.push(e),this._$pools$_.push([e,i]),e}remove(t){let s=this._$objects$_.indexOf(t);if(-1===s)throw"noscene rm";this._$objects$_.splice(s,1),s=this._$pools$_.findIndex((([s])=>s===t)),-1!==s&&this._$pools$_.splice(s,1)}init(){return this._$life$_=0,this._$_init$_(),this}update(){var t,s,e;if(0===this._$life$_&&this._$_first_update$_(),this._$objects$_.forEach((t=>t.update())),this._$life$_+=i.delta,this._scheds=this._scheds.map((([t,s])=>(t-i.delta<0&&s(),[t-i.delta,s]))).filter((t=>t[0]>0)),this._$pools$_.slice(0).forEach((([t,s])=>{let i=this._$pools$_.filter((s=>s[0].constructor.name===t.constructor.name));if(i.length>s){let t=i[0][0];this.remove(t)}})),h.click){let s=320*h.click[0],i=180*h.click[1];for(let[e,h]of this._$_mouses$_)x(...A(e),s,i)&&(null==(t=h._$on_click$_)||t.call(h))}if(h.move){let t=320*h.move[0],i=180*h.move[1];for(let[h,r]of this._$_mouses$_)x(...A(h),t,i)?r._$_hovering$_||(r._$_hovering$_=!0,null==(s=r._$on_hover_begin$_)||s.call(r)):(r._$_hovering$_&&(null==(e=r._$on_hover_end$_)||e.call(r)),r._$_hovering$_=!1)}this._$_update$_()}_$draw$_(t,s){this._$_pre_draw$_(t,s),this._$objects$_.forEach((i=>i._$draw$_(t,s))),this._$_draw$_(t,s)}_$_init$_(){}_$_first_update$_(){}_$_update$_(){}_$_draw$_(t,s){}_$_pre_draw$_(t,s){}}class _ extends g{constructor(){super(...arguments),s(this,"x",0),s(this,"y",0),s(this,"scale_x",1),s(this,"scale_y",1),s(this,"_current_frame",0),s(this,"__elapsed",0)}get data(){return this._$_data$_}get info(){let t=l.info.find((t=>t.name===this._$_name$_));if(!t)throw`nosprite ${this._$_name$_}`;return t}get tag(){let t=this.info.tags.find((t=>t.name===this._$_tag$_));if(!t)throw`notag ${this._$_name$_} ${this._$_tag$_}`;return t}get _$_name$_(){return this.data.name}get _$_tag$_(){return this.data.tag||"idle"}_$xy$_(t,s){this.x=t,this.y=s}get current_frame(){let{from:t}=this.tag;return this.info._$packs$_[this._current_frame+t]}get _$s_origin$_(){return this.data._$s_origin$_??"c"}get _$origin_x$_(){if("tl"===this._$s_origin$_)return 0;let{_$fw$_:t}=this.current_frame;return"c"===this._$s_origin$_||"bc"===this._$s_origin$_?t/2:0}get _$origin_y$_(){if("tl"===this._$s_origin$_)return 0;let{_$fh$_:t}=this.current_frame;return"c"===this._$s_origin$_?t/2:"bc"===this._$s_origin$_?t:0}_$play_tag$_(t){this.data.tag=t,this._current_frame=0,this.__elapsed=0}_$_update$_(){let{from:t,to:s}=this.tag,{duration:e}=this.current_frame,h=s-t;this.__elapsed+=1e3*i.delta,this.__elapsed>=e&&(this.__elapsed-=e,this._current_frame===h?this._current_frame=0:this._current_frame+=1)}_$_draw$_(t,s){let{x:i,y:e,_$scale_x$_:h,_$scale_y$_:r}=this;t._$anim$_(this,i,e,h,r)}}function w(t,s,i){return Math.max(Math.min(t,i),s)}const p=t=>Math.sin(t),f=t=>(t%6.28-3.14)/6.28,y=t=>w(1e3*Math.sin(t),-1,1);let m,k;m=new AudioContext,k=m.sampleRate;let b=[["intro",[[0,2,3,5,7,12],1.3],0]],M=[["start",.737,t=>(t*=-999)&&.6*p(t/(20+p(t/900+p(t/440+p(t/222)))-t/400))],["click",.737,t=>(t*=-999)&&.6*p(t/(20+p(t/900+p(t/440+p(t/222)))-t/400))],["open",.93,t=>.555*y(30*p(3*t)/(30-3*t)*p(y(t)))+.455*f(2/f(3*f(4/y(3*Math.random()*p(.2*t)+6/p(t)*.8))))],["nbuzz",2.321,t=>(y(t)<.3*p(t)?-13:10)*f(y(t/10)<.5?30*t:50*t)+p(30*t)]];const v=async t=>{async function s(){return new Promise((t=>setTimeout(t,0)))}function i(s){t(s)}let e,h,r,n,o,l,a={},c={},u=!0;async function d(t,i){let e=m.createBuffer(1,k*t,k),h=e.getChannelData(0),r=e.length;for(let s=0;s<r;s++)h[s]=i(44100*s/k)*(1-s/r);return await s(),e}async function x([t,i],e){const h=[],r=[],o=[4,2,.5,3,4][e],l=[1,.5,.25,2,2][e++],a=[-15,-20,-19,-12];r.push([e*e*3*.5%2,e%2],[.5*(e*e*3+9*e)%2,(e+1)%2],[.5*(e*e*2+11*e)%2,(e+1)%2]);for(let s=0;s<3;s++){const i=8*s,r=[0,3,-5][s];for(let t=0;t<8;t++)h.push([a[(7*e+2*s+(t>>1)+t*t*3)%4]+r,t+i,6,1]);for(let n=0;n<8/l;n++)(n+n*n+s+3*e)%7<4&&h.push([-3+r+t[(n+n*n*2+s*s*2+e)%t.length],n*l+i,o,2])}const c=m.createBuffer(1,8*k*3*i,k),u=c.getChannelData(0);for(let n=0;n<h.length;n++){let t,e,r,o;[t,e,r,o]=h[n];const l=Math.floor(e*i*k),a=r*i*k;for(let s=0;s<a;s++){let i=0;const e=s/a;i+=1==o?2*w(p(s/(6*2**(-t/12)*2*2)+p(s/8e3))*(44*Math.exp(23*-e)+1),-1,1):7*f(s/(24.18*2**(-t/12)*2)),u[l+s]+=i*Math.min(e*Math.exp(-e*(10+7*o))*100,1)/500}await s()}for(let d=0;d<44;d+=2){for(let t=0;t<r.length;t++){let s,e;[e,s]=r[t];const h=Math.floor(.5*k*s),o=Math.floor((e+d)*k*i);for(let t=0;t<.1*k;t++)u[t+o]+=n[t+h]}await s()}return c}function A(t){let s=e;t&&(e=m.createBufferSource(),e.buffer=t,e.loop=!0,e.connect(u?o:l),e.start()),setTimeout((()=>{null==s||s.stop()}),700),o.gain.setTargetAtTime(u?1:0,m.currentTime,.5),l.gain.setTargetAtTime(u?0:1,m.currentTime,.5),u=!u}return await async function(){let t=M.length+b.length+1;for(let s in M){let[e,h,r]=M[s],n=await d(h,r);i((Number(s)+1)/t),a[e]=n}r=m.createBuffer(1,k,k),n=r.getChannelData(0);const e=.1*k;for(let s=0;s<e;s++)n[s]+=.01*(p(s/(70+s/300))+Math.random()/3)*(1-s/e),n[Math.floor(.5*k)+s]+=.01*Math.random()*(1-s/e);await s(),h=m.createBuffer(1,3*k,k);const u=h.getChannelData(0);for(let s=0;s<3*k;s++){const t=s/k;u[s]=w(Math.sin(s/120)*(10+10*p(s/1e4+t*t*t*4)),-1,1)*t/50}await s();for(let s in b){let[e,h,r]=b[s],n=await x(h,r);i((M.length+(Number(s)+1))/t),c[e]=n}o=new GainNode(m),o.connect(m.destination),l=new GainNode(m),l.connect(m.destination)}(),[t=>function(t){let s=m.createBufferSource();s.buffer=t,s.connect(m.destination),s.start()}(a[t]),t=>function(t){if(!t)return void A();if(!c[t])throw`nomusic ${t}`;A(c[t])}(t)]},B=class{constructor(){s(this,"_loaded",!1),s(this,"_fx"),s(this,"_music"),s(this,"_music_onoff",!0),s(this,"_last_music")}get loaded(){return this._$_loaded$_}async load(t){this.loaded||([this._$_fx$_,this._$_music$_]=await v(t),this._$_loaded$_=!0,t(1))}get _$music_onoff$_(){return this._music_onoff}set _$music_onoff$_(t){var s,i;this._music_onoff=t,this._music_onoff?null==(i=this._$_music$_)||i.call(this,this._$_last_music$_):null==(s=this._$_music$_)||s.call(this)}fx(t){var s;null==(s=this._$_fx$_)||s.call(this,t)}_$music$_(t){var s;this._$_last_music$_=t,this._$music_onoff$_&&(null==(s=this._$_music$_)||s.call(this,t))}};s(B,"make",(()=>new B));const z=B.make();function C(t,s){return s<<8*(4-t)}const D=[[[0,3,8,12],[3,16,9,12],[16,20,10,12]]],Q=0,L={[Q]:!0,2:!0};function E(t,s,i,e){return C(1,t)|C(2,s)|C(3,i)|C(4,e)}const O={[E(1,2,1,2)]:[4,0],[E(1,2,2,2)]:[1,0],[E(2,2,2,2)]:[3,2],[E(2,Q,2,2)]:[0,2],[E(2,2,2,Q)]:[3,2],[E(2,Q,2,Q)]:[3,2]},U={2:O,3:O},P=[0,0],W={2:P,3:P,1:[3,1]},j=class{constructor(t){s(this,"sx"),s(this,"sy"),this.cluster=t}get _$sw$_(){return 16}get _$sh$_(){return 16}get _$solid$_(){return L[this.cluster]}_$auto_set$_(t){var s;let[i,e]=(null==(s=U[this.cluster])?void 0:s[t])??W[this.cluster];this._$sx$_=16*i,this._$sy$_=16*e}};s(j,"cluster",(t=>new j(t)));let F=j;const q=16,H=class{constructor(t){this.grid=t}_$auto_tiles_set_complete$_(){!function(t){const s=t.length,i=t[0].length;for(let e=0;e<s;e++)for(let s=0;s<i;s++){let i=0;[[e,s-1],[e-1,s],[e+1,s],[e,s+1]].forEach((([s,e],h)=>{var r,n;i|=C(h+1,(null==(n=null==(r=t[s])?void 0:r[e])?void 0:n.cluster)??Q)})),t[e][s]._$auto_set$_(i)}}(this.grid)}_$add_collider$_(t){let s=Math.floor(t.x/q),i=Math.floor(t.y/q),e=Math.floor((t.x+t.w-1)/q),h=Math.floor((t.y+t.h-1)/q);for(let r=s;r<=e;r++)for(let s=i;s<=h;s++)this.grid[r][s]=F.cluster(t.cluster)}_$is_solid_xywh$_(t,s,i){let{x:e,y:h,w:r,h:n}=t,o=r/2;try{return this._$is_solid_rect$_(e-o+s,h-n+i,r,n)}catch(l){return!0}}_$is_solid_rect$_(t,s,i=1,e=1){let h=t/q,r=s/q,n=(t+i-1)/q,o=(s+e-1)/q;if(h<0||n>=20||r<0||o>=12)throw`outbounds ${t} ${s}`;for(t=h;t<=n;t++)for(s=r;s<=o;s++)if(t=Math.floor(t),s=Math.floor(s),this.grid[t][s]._$solid$_)return!0;return!1}get _$tiles$_(){let t=[];for(let s=0;s<20;s++)for(let i=0;i<12;i++)t.push([s*q,i*q,this.grid[s][i]]);return t}};s(H,"make",(()=>{let t=[];for(let i=0;i<=20;i++)t.push(new Array(12).fill(F.cluster(1)));D.forEach((s=>{s.forEach((s=>{let[i,e,h,r]=s;for(;h<r;){let s=i;for(;s<e;)t[Math.floor(s)][Math.floor(h)]=F.cluster(2),s++;h++}}))}));let s=new H(t);return s._$auto_tiles_set_complete$_(),s}));let I=H,N=[c.red,c.darkred];class V extends g{constructor(){super(...arguments),s(this,"grid"),s(this,"_anims_by_tile"),s(this,"debug",!1)}_$_init$_(){this.grid=I.make(),this._$_anims_by_tile$_=new Map}_$_update$_(){i._$on_interval$_(.86543)&&([N[1],N[0]]=[N[0],N[1]])}_$_draw$_(t){this.grid._$tiles$_.forEach((([s,i,e])=>{if(this.debug)e._$solid$_&&t._$srect$_(N[(s+i)/q%2],s,i,q,q);else{let h=s,r=i,{_$sx$_:n,_$sy$_:o,_$sw$_:l,_$sh$_:a}=e;t._$spr$_(h,r,n,o,l,a)}}))}}const X=((t=1)=>()=>{var s=1e4*Math.sin(t++);return s-Math.floor(s)})();function G(t){return t[function(t,s=X){return Math.floor(s()*t)}(t.length)]}const K=class{constructor(){s(this,"_elapsed",0),s(this,"time_left",30),s(this,"time_begin",!1),s(this,"experience",["play"])}get code(){return"hello"}get _$rank$_(){return 0}get _$time_elapsed$_(){return Math.ceil(this._elapsed)}get _$last_ten$_(){return this.time_left<=13}get _$times_up$_(){return 0===this.time_left}track(t){this.experience.push(t)}update(){this._elapsed+=i.delta,this._$time_begin$_&&(this.time_left-=i.delta,this.time_left<0&&(this.time_left=0))}};s(K,"make",(()=>new K)),s(K,"from_code",(t=>new K));let T=K;function Y(t,s,i,e){return Math.abs(Math.sqrt(t*t+s*s)-Math.sqrt(i*i+e*e))}[new T,new T].every((t=>T.from_code(t.code).code===t.code))?console.log("codes ok"):console.log("codes wrong");const R=t=>t/320*1920,J=t=>t/180*1080,S=t=>t/1920*320,Z=t=>t/1080*180,$=1e-5,tt=2.58002,st=2.7812,it=(t,s)=>Math.sqrt(Math.abs(t*t-s*s));class et extends g{constructor(){super(...arguments),s(this,"world"),s(this,"solid")}init(){return this._$world$_=this.make(rt),this._$solid$_=this.make(V),super.init()}_$_update$_(){let{grid:t}=this._$solid$_,{_$bodies$_:s}=this._$world$_;s.forEach((s=>{for(let e=3;e>=1;e--){let h=2*e/9,r=st*s._$_scale_G$_,n=0;{let e=Math.abs(s.dy),o=Math.sign(s.dy);for(let l=h;l<=e;l+=h){let a=.5*o*l*Math.sqrt(i.delta);if(t._$is_solid_xywh$_(s,0,a)){s._$collide_v$_=o,s.dy=0,n=0;break}s._$collide_v$_=0,s.y+=a,n=1-o*((l-h)/(e-h));{let t=.044311*r*Math.sqrt(n),e=1;s.dy+=e*t*i.delta}}}{let e=.877*r,n=1;for(let r=h;r<=e;r+=h){let e=.5*n*r*Math.sqrt(i.delta);if(t._$is_solid_xywh$_(s,0,e)){s._$collide_v$_=n,s.dy=0;break}s._$collide_v$_=0,s.y+=e}}{let e=Math.abs(s.dx),r=Math.sign(s.dx),n=1.8*Math.pow(2.2*it(s.dy,1),.18*-it(s.dy,1));for(let o=h;o<=e;o+=h){let e=.5*r*o*Math.sqrt(i.delta)*n;if(t._$is_solid_xywh$_(s,e,0)){s._$collide_h$_=r,s.dx=0;break}s._$collide_h$_=0,s.x+=e}}}}))}}class ht extends g{constructor(){super(...arguments),s(this,"_scale_G"),s(this,"variance"),s(this,"lerp_x"),s(this,"lerp_y"),s(this,"world"),s(this,"collide_v"),s(this,"collide_h"),s(this,"_w"),s(this,"_h"),s(this,"x"),s(this,"y"),s(this,"dx"),s(this,"dy")}get data(){return this._$_data$_}_$switch$_(t,s={}){var i;return null==(i=this._$world$_)?void 0:i._$_switch$_(this,t,s)}get _$ceiling$_(){return this._$collide_v$_<0}get _$grounded$_(){return this._$collide_v$_>0}get _$left_wall$_(){return this._$collide_h$_<0}get _$right_wall$_(){return this._$collide_h$_>0}get w(){return this._$_w$_}get h(){return this._$_h$_}init(){return this.x=this.data.x??0,this.y=this.data.y??0,this._$_w$_=this.data.w,this._$_h$_=this.data.h,this.dx=0,this.dy=0,this._$_scale_G$_=this.data._$scale_G$_??1,this._$variance$_=ot,this._$lerp_x$_=void 0,this._$lerp_y$_=void 0,super.init()}update(){if(this._$lerp_x$_){let[t,s,e]=this._$lerp_x$_;e<=$?this._$lerp_x$_=void 0:(this.x=this.x+(t-this.x)*(1-e/s),this._$lerp_x$_[2]-=i.delta)}if(this._$lerp_y$_){let[t,s,e]=this._$lerp_y$_;e<=$?this._$lerp_y$_=void 0:(this.y=this.y+(t-this.y)*(1-e/s),this._$lerp_y$_[2]-=i.delta)}super.update()}}class rt extends g{get _$bodies$_(){return this._$objects$_}body(t,s={}){let i=this.make(t,s);return i._$world$_=this,i}_$_switch$_(t,s,i={}){let e=this._$bodies$_.indexOf(t);if(-1===e)throw bt.track("error"),"nobody";return this._$bodies$_.splice(e,1),t._$world$_=void 0,this.body(s,i)}filter(t){return this._$bodies$_.filter((s=>s.constructor.name===t.name))}}class nt extends ht{constructor(){super(...arguments),s(this,"anim")}get data(){return this._$_data$_}init(){return this._$anim$_=this.make(_,this.data),super.init()}update(){this._$anim$_.x=this.x,this._$anim$_.y=this.y,super.update()}}const ot=.6234;function lt(t=1,s=ot){let i=-t,e=+t;return(X()*(e-i)+i)*s}function at(t,s=ot){return Math.floor(t/2+lt(t/2,s)+1)}function ct(t,s=ot){return t/2+lt(t/2,s)}class ut extends nt{constructor(){super(...arguments),s(this,"picked")}update(){let{_$picked$_:t}=this;t&&(bt.track("pickup"),i._$on_interval$_(.2)&&(this._$pool$_(dt,{x:this.x,y:this.y-8}),this._$lerp_x$_=[t.x,.3,.3],this._$lerp_y$_=[t.y,.3,.3])),super.update()}}class dt extends ht{constructor(){super(...arguments),s(this,"text"),s(this,"color"),s(this,"size")}_$_init$_(){this.text=at(6)<3?"z":"Z",this.color=G(c.all),this.size=52+at(32)}_$_update$_(){this.y-=1.3906*Math.sqrt(i.delta),this.x+=lt(6.222,.1)}_$_draw$_(t,s){s._$str$_(this.text,R(this.x),J(this.y),this.size,this.color)}}class xt extends ut{_$_update$_(){if(this._$picked$_)return;let{_$variance$_:t}=this;if(i._$on_interval$_(.1764)){let s=lt(6.222,t);this._$lerp_x$_=[this.x+s,.2,.2]}if(i._$on_interval$_(.242)){let s=lt(6.323,t);this._$lerp_y$_=[this.y+s,.2,.2]}}}class At extends ut{}class gt extends nt{constructor(){super(...arguments),s(this,"_pickup"),s(this,"_pre_grounded",!1),s(this,"_sudden_slow")}get _$facing$_(){return this._$anim$_._$scale_x$_}_$_init$_(){this._$_sudden_slow$_=.5}_$dusty$_(t){this._$pool$_(Qt,{x:this.x-8*this._$facing$_+t,y:this.y-8},4)}_$_update$_(){this._$grounded$_&&!this._$_pre_grounded$_&&(bt.track("jump"),this._$dusty$_(0),this._$sched$_(.1,(()=>this._$grounded$_&&this._$dusty$_(-9))),this._$sched$_(.1,(()=>this._$grounded$_&&this._$dusty$_(9))),this._$sched$_(.2,(()=>this._$grounded$_&&this._$dusty$_(-19))),this._$sched$_(.2,(()=>this._$grounded$_&&this._$dusty$_(19)))),i._$on_interval$_(lt(3)),this._$_pre_grounded$_=this._$grounded$_,o._$btn$_("left")?(bt.track("left"),this._$anim$_._$scale_x$_=-1,this.dx=-tt):o._$btn$_("right")?(bt.track("right"),this._$anim$_._$scale_x$_=1,this.dx=tt):this.dx=0,o._$btn$_("jump")&&(this._$grounded$_?this.dy=-3.6155600000000003:bt.track("fly")),o._$btnp$_("pickup")&&(this._$_pickup$_?(this._$_pickup$_._$picked$_=void 0,this._$_pickup$_=void 0):(this._$_pickup$_=this._$find_pickup$_(xt)||this._$find_pickup$_(At),this._$_pickup$_&&(z.fx("open"),this._$_pickup$_._$picked$_=this,bt._$time_begin$_=!0,this._$_sudden_slow$_=.6))),this._$_sudden_slow$_>0&&(this._$_sudden_slow$_-=i.delta,this._$_sudden_slow$_<0&&(this._$_sudden_slow$_=0),this.dx*=Math.pow(2,-it(this._$_sudden_slow$_,.5)))}_$find_pickup$_(t){var s;let{x:i,y:e}=this,h=null==(s=this._$world$_)?void 0:s.filter(t).map((t=>[t,Y(t.x,t.y,i,e)])).sort(((t,s)=>t[1]-s[1]))[0];if(h&&h[1]<10)return h[0]}}class _t extends g{get data(){return this._$_data$_}_$_draw$_(t){let{color:s,x:i,y:e,w:h,h:r}=this.data;t._$srect$_(s,i,e,h,r)}}class wt extends g{constructor(){super(...arguments),s(this,"_lerp_to"),s(this,"_lerp_t",0)}get data(){return this._$_data$_}lerp(t,s=.142){this._$_lerp_to$_=t,this._$_lerp_t$_=s}_$_update$_(){if(this._$_lerp_t$_>0){let t=1-this._$_lerp_t$_/.2;this.data.color=c.lerp(this.data.color,this._$_lerp_to$_,t),this._$_lerp_t$_-=i.delta,this._$_lerp_t$_<0&&(this._$_lerp_t$_=0)}}_$_draw$_(t){let{color:s,x:i,y:e,w:h,h:r}=this.data;t.rect(s,i,e,h,r)}}class pt extends g{constructor(){super(...arguments),s(this,"hovering",!1),s(this,"click_t",0),s(this,"w",60),s(this,"h",22),s(this,"bg")}get data(){return this._$_data$_}get x(){return this.data.x}get y(){return this.data.y}_$_init$_(){let{w:t,h:s}=this;this._$bg$_=this.make(wt,{color:c.darkblue,x:3,y:2,w:t,h:s}),this.make(_t,{color:c.lightblue,x:3,y:2,w:t,h:s}),this.make(Dt,{x:R(t/2-2),y:J(s/2+2),size:74,text:this.data.text,align:"c"});let i=this;this._$add_mouse$_(this.x,this.y,this.w,this.h,{_$on_click$_(){z.fx("click"),i._$click_t$_=.073454,i._$bg$_.lerp(c.red,i._$click_t$_)},_$on_hover_begin$_(){i._$bg$_.lerp(c.lightblue)},_$on_hover_end$_(){i._$bg$_.lerp(c.darkblue)}})}_$_update$_(){this._$click_t$_>0&&(this._$click_t$_-=i.delta,this._$click_t$_<=0&&(this._$click_t$_=0,this._$bg$_.lerp(c.lightblue,.345)))}_$_pre_draw$_(t,s){t._$push_xy$_(this.data.x,this.data.y),s._$push_xy$_(R(this.data.x),J(this.data.y))}_$_draw$_(t,s){t.pop(),s.pop()}}class ft extends g{constructor(){super(...arguments),s(this,"align"),s(this,"blue_text"),s(this,"retro_text"),s(this,"music_text"),s(this,"music_ontext"),s(this,"time_text")}get data(){return this._$_data$_}_$_init$_(){this.align=[],this.make(wt,{color:c.darkblue,x:3,y:2,w:84,h:42}),this.make(_t,{color:c.lightblue,x:3,y:2,w:84,h:42}),this.make(_t,{color:c.red,x:2,y:1,w:86,h:44}),this._$blue_text$_=this.make(Dt,{x:50,y:100,size:74,text:"blue"}),this._$retro_text$_=this.make(Dt,{x:150,y:100,size:74,text:"retro"});let t=this;this._$add_mouse$_(S(50),Z(26),S(500),Z(74),{_$on_click$_(){t.data._$on_credits$_()},_$on_hover_begin$_(){t._$blue_text$_.color=c.lightblue,t._$retro_text$_.color=c.purple},_$on_hover_end$_(){t._$blue_text$_.color=c.light,t._$retro_text$_.color=c.light}}),this.align.push({margin:89,h:[this._$blue_text$_,this._$retro_text$_]}),this.make(Dt,{x:50,y:170,size:54,text:"time"}),this._$time_text$_=this.make(Ct,{x:280,y:170,size:54,text:"02:00"}),this._$music_text$_=this.make(Dt,{x:50,y:228,size:54,text:"music"}),this._$music_ontext$_=this.make(Dt,{x:280,y:228,size:54,text:"on"}),this._$add_mouse$_(S(50),Z(174),S(280),Z(54),{_$on_click$_(){z._$music_onoff$_=!z._$music_onoff$_,t._$update_sound_text$_()},_$on_hover_begin$_(){t._$music_ontext$_.color=c.red},_$on_hover_end$_(){t._$music_ontext$_.color=c.light}}),this.make(pt,{x:250,y:4,text:"Right"}),this.make(pt,{x:180,y:4,text:"Left"}),this.make(pt,{x:220,y:30,text:"Jump"}),t._$update_sound_text$_()}_$update_sound_text$_(){z._$music_onoff$_?(bt.track("music on"),this._$music_ontext$_.text="on"):(bt.track("music off"),this._$music_ontext$_.text="off")}_$_update$_(){bt._$last_ten$_,this._$time_text$_.text=function(t){function s(t){return t<10?`0${t}`:`${t}`}return`${s(Math.floor(t/60))}:${s(Math.floor(t%60))}`}(bt.time_left),o._$btnp$_("music")&&(bt.track("key m"),z._$music_onoff$_=!z._$music_onoff$_,this._$update_sound_text$_()),this.align.forEach((t=>{var s;let i=t.margin??0;null==(s=t.h)||s.reduce(((t,s)=>(s.x=t.x+t.width+i,s)))}))}}class yt extends g{constructor(){super(...arguments),s(this,"parent")}_$add_scene$_(t,s={}){let i=this.make(t,s);return i.parent=this,i}_$switch_scene$_(t,s={}){var i,e;null==(i=this.parent)||i.remove(this),null==(e=this.parent)||e._$add_scene$_(t,s)}}class mt extends yt{constructor(){super(...arguments),s(this,"_countdown")}_$_init$_(){this._$_countdown$_=0,z._$music$_("intro"),this.make(Ot);let t=this;this.make(ft,{_$on_credits$_(){t._$switch_scene$_(Mt),bt.track("credits link")}})}_$_update$_(){bt.update(),bt._$times_up$_&&(bt.track("game end"),this.make(kt),0===this._$_countdown$_&&(this._$_countdown$_=5.432)),this._$_countdown$_>0&&(this._$_countdown$_-=i.delta,this._$_countdown$_<=0&&(this._$switch_scene$_(Mt),bt.track("countdown credits")))}}class kt extends g{_$_init$_(){this.make(Dt,{x:960,y:540,size:123,text:"good game ὄ"}),this.make(Dt,{x:960,y:612,size:43,text:"every thing just never asks"}),this.make(Dt,{x:960,y:642,size:43,text:".",color:c.darkpurple})}}let bt=T.make();class Mt extends yt{constructor(){super(...arguments),s(this,"texts"),s(this,"sub_texts"),s(this,"end_message_texts"),s(this,"code_text"),s(this,"end_message_text"),s(this,"info_text"),s(this,"last_progress"),s(this,"_hold",!1)}_$_init$_(){this._$last_progress$_=bt,bt=T.make(),z._$music_onoff$_=!1,this.make(wt,{color:c.green,x:0,y:0,w:320,h:180}),this.make(Dt,{color:c.lightpurple,x:-1070,y:1020,size:9e3,text:"E"}),this._$info_text$_=this.make(Dt,{color:c.darkblue,x:0,y:1e3,size:38,text:"press jump or pickup to pause"});let t=480;this._$end_message_texts$_=[this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:`you've invested "${this._$last_progress$_._$time_elapsed$_}" knucles back to your future.`}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"don't ever"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"for any reason"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"no matter what you're doing"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"or where you are"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"or who you've been with"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"for any reason"}),this.make(Dt,{color:c._$white$_,x:t,y:100,size:40,text:"no matter whatsoever"})],this._$code_text$_=this.make(Dt,{color:c.darkpurple,x:t,y:100,size:40,text:"please send your secret code wait_x2_not in the end to me;"}),this._$sub_texts$_=[this.make(Dt,{color:c.red,x:t,y:100,size:70,text:"watermelon or an exotic pomengrate"}),this._$end_message_texts$_[0],this.make(Dt,{color:c._$white$_,x:t,y:100,size:70,text:"watermelon or an exotic pomengrate"}),this._$end_message_texts$_[1],this.make(Dt,{color:c.darkblue,x:t,y:100,size:70,text:"watermelon or an exotic pomengrate"}),this._$end_message_texts$_[2],this.make(Dt,{color:c.darkblue,x:t,y:100,size:70,text:"watermelon or an exotic pomengrate"}),this._$end_message_texts$_[3],this.make(Dt,{color:c.darkblue,x:t,y:100,size:70,text:"watermelon or an exotic pomengrate"}),this._$end_message_texts$_[4],this._$end_message_texts$_[5],this._$end_message_texts$_[6]],this._$texts$_=[this.make(Dt,{color:c.darkpurple,x:t,y:100,size:90,text:"thanks for playing"}),this._$code_text$_,this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"art twitter.com/_V3X3D"}),this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"music github.com/arikwex"}),this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:90,text:"author twitter.com/eguneys"}),this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:120,text:"Mucho Gracias <3"}),this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:80,text:"Check out my PostMortem too!"}),this.make(Dt,{color:c.darkpurple,x:t,y:1e3,size:120,text:"bb"})];let s=this;this._$add_mouse$_(0,0,320,180,{_$on_click$_(){s._$life$_>2&&(bt.track("reset"),s._$switch_scene$_(vt))}})}_$_update$_(){if((o._$btnp$_("jump")||o._$btnp$_("pickup"))&&(this._$_hold$_=!this._$_hold$_,this._$_hold$_||(this._$info_text$_.color=c._$grey$_,this._$info_text$_.size-=10)),this._$_hold$_)return this._$info_text$_._$o_x$_=7+10*Math.cos(3*this._$life$_),void(this._$info_text$_._$o_y$_=3+10*Math.sin(7*this._$life$_));this._$info_text$_._$o_x$_=0,this._$info_text$_._$o_y$_=0,this._$sub_texts$_[0].y+=180*i.delta,this._$sub_texts$_[0].y>1080*this._$sub_texts$_.length-100&&(this._$code_text$_.text=this._$code_text$_.text.replace("wait_x2_not",this._$last_progress$_.code)),this._$sub_texts$_[0].y%=1080*this._$sub_texts$_.length-100,this._$sub_texts$_.reduce(((t,s)=>(s.y=t.y-t.height-777,s))),this._$texts$_[0].y+=200*i.delta,this._$texts$_[0].y>1080*this._$texts$_.length-100&&(this._$code_text$_.text=this._$code_text$_.text.replace("wait_x2_not",this._$last_progress$_.code)),this._$texts$_[0].y%=1080*this._$texts$_.length-100,this._$texts$_.reduce(((t,s)=>(s.y=t.y-t.height-777,s)))}}class vt extends yt{constructor(){super(...arguments),s(this,"begin_text1"),s(this,"begin_text2")}_$_first_update$_(){console.log("here")}_$_init$_(){this.make(wt,{color:c.darkblue,x:0,y:0,w:320,h:180}),this.make(Dt,{color:c.lightblue,x:-250,y:1020,size:6e3,text:"V"}),this.make(Dt,{x:50,y:170,size:112,text:"2 minute ssir..",color:c.light}),this.make(Dt,{x:960,y:540,size:112,text:"blue",color:c.light}),this.make(Dt,{x:1280,y:540,size:112,text:"retro",color:c.light}),this.make(Dt,{x:640,y:900,size:112,text:"by",color:c.light}),this.make(Ct,{x:840,y:900,size:112,text:"eguneys",color:c.light}),this._$begin_text1$_=this.make(Dt,{x:0,y:1030,size:62,text:"click to begin",color:c.light}),this._$begin_text2$_=this.make(Dt,{x:0,y:1030,size:62,text:"click to begin",color:c.light}),z.load((t=>{let s=1===t?"click to begin":`loading sounds ${Math.floor(100*t)}%`;this._$begin_text1$_.text=s,this._$begin_text2$_.text=s,console.log(s),bt.track("sound")}));let t=this;this._$add_mouse$_(0,0,320,180,{_$on_click$_(){z.loaded&&(t._$switch_scene$_(mt),bt.track("load game"))}})}_$_update$_(){this._$begin_text1$_.x+=300*i.delta,this._$begin_text2$_.x+=300*i.delta,this._$begin_text1$_.x+this._$begin_text1$_.width>1920&&(this._$begin_text2$_.x=this._$begin_text1$_.x-1920),this._$begin_text2$_.x+this._$begin_text2$_.width>1920&&(this._$begin_text1$_.x=this._$begin_text2$_.x-1920)}}const Bt=class extends yt{_$_init$_(){this._$add_scene$_(vt)}_$_pre_draw$_(t,s){t.clear(),s.clear()}};s(Bt,"make",(()=>(new Bt).init()));let zt=Bt;class Ct extends g{constructor(){super(...arguments),s(this,"_width",0),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color"),s(this,"lc")}get data(){return this._$_data$_}get width(){return this._$_width$_}get height(){return this.size}_$_init$_(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??c.light,this._$lc$_=[]}_$_update$_(){i._$on_interval$_(.2)&&(this._$lc$_=this.text.split("").map((t=>[t,G(c.all)])))}_$_draw$_(t,s){this._$_width$_=0,this._$lc$_.map((([t,i])=>{let e=s._$str$_(t,this.x+this._$_width$_,this.y,this.size,i);this._$_width$_+=e}))}}class Dt extends g{constructor(){super(...arguments),s(this,"_width",0),s(this,"o_x"),s(this,"o_y"),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color")}get data(){return this._$_data$_}get width(){return this._$_width$_}get height(){return this.size}_$_init$_(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??c.light,this._$o_x$_=0,this._$o_y$_=0}_$_draw$_(t,s){this._$_width$_=s._$str$_(this.text,this._$o_x$_+this.x,this._$o_y$_+this.y,this.size,this.color,this.data.align)}}class Qt extends g{get data(){return this._$_data$_}_$_init$_(){this.make(_,{name:"bounce",tag:`${5+Math.floor(lt(4))}`})._$xy$_(this.data.x,this.data.y)}}class Lt extends g{_$_init$_(){for(let t=0;t<16+lt(8);t++){this.make(_,{name:"dust",tag:"s"})._$xy$_(90+lt(320),lt(180))}}}class Et extends g{constructor(){super(...arguments),s(this,"world"),s(this,"ones")}get data(){return this._$_data$_}_$_init$_(){this._$world$_=this.data._$world$_,this._$ones$_=[]}_$_update$_(){if(i._$on_interval$_(at(at(3.2)+1))){let[t,s]=G([[xt,{name:"fly",x:60+at(190),y:30+at(60),w:16,h:16,_$scale_G$_:.03+ct(.3),_$s_origin$_:"bc"}],[At,{name:"ghoul",x:at(320),y:130,w:16,h:16,_$scale_G$_:.03+ct(.3),_$s_origin$_:"bc"}]]);if(this._$ones$_.length<2||this._$ones$_.length<at(2+at(6)))this._$ones$_.push(this._$world$_.body(t,s));else{let i=this._$ones$_.shift();i&&(i._$picked$_||this._$ones$_.push(i._$switch$_(t,s)))}}}}class Ot extends et{_$_init$_(){this.make(Lt),this.make(Et,{_$world$_:this._$world$_}),this._$world$_.body(gt,{name:"player",x:8,y:80,w:16,h:16,_$s_origin$_:"bc"})}}!async function(t){await l.load(),function(t){let s=d.make(1920,1080,!1),i=d.make(320,180),r=zt.make();e._$run$_({_$on_update$_(){h.update(),o.update(),r.update()},_$on_render$_(){r._$draw$_(i,s)}}),t.appendChild(i.canvas),t.appendChild(s.canvas),h._$listen$_(t)}(t)}(document.getElementById("app"));
