var t=Object.defineProperty,s=(s,i,e)=>(((s,i,e)=>{i in s?t(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e})(s,"symbol"!=typeof i?i+"":i,e),e);const i=new class{constructor(){s(this,"ticks_per_second",1e3),s(this,"ticks",0),s(this,"seconds",0),s(this,"delta",0),s(this,"previous_ticks",0),s(this,"previous_seconds",0),s(this,"pause_timer",0)}t(t){t>=this.i&&(this.i=t)}h(t,s=0){let i=this.seconds,e=this.delta;return Math.floor((i-s-e)/t)<Math.floor((i-s)/t)}A(t,s){let i=Math.floor(t)-this.delta;return t>=s&&i<s}o(t,s=0){let i=this.seconds;return h=2*t,(e=i-s)-Math.floor(e/h)*h>=t;var e,h}};const e=new class{constructor(){s(this,"app_time_last"),s(this,"app_time_accumulator",0)}l(t){const s=()=>{t.u()},e=h=>{let r=Math.min(25,h-(this.g??h));this.g=h,this.p+=r,i.delta=r/i.ticks_per_second,i.i>0?i.i-=i.delta:(i.m=i._,i._+=r,i.C=i.seconds,i.seconds+=i.delta,s()),t.B(),requestAnimationFrame(e)};requestAnimationFrame(e)}},h=class{constructor(){s(this,"_btn_pre",!1),s(this,"_btn",0)}get M(){return this.k}get D(){return this.F>0}v(t){this.F="down"===t?1:0}update(){1!==this.F||this.k?this.k=!1:this.k=!0,1===this.F&&(this.F=2)}};s(h,"make",(()=>new h));let r=h;const n=new class{constructor(){s(this,"action_map"),s(this,"key_map"),this.L={jump:r.make(),left:r.make(),right:r.make(),down:r.make()},this.H={w:"jump",a:"left",s:"down",d:"right",ArrowUp:"jump",ArrowLeft:"left",ArrowDown:"down",ArrowRight:"right"},document.addEventListener("keydown",(t=>{var s;return null==(s=this.L[this.H[t.key]])?void 0:s.v("down")})),document.addEventListener("keyup",(t=>{var s;return null==(s=this.L[this.H[t.key]])?void 0:s.v("up")}))}M(t){return this.L[t].M}D(t){return this.L[t].D}update(){for(let t of Object.keys(this.L))this.L[t].update()}};const A=new class{constructor(){s(this,"image"),s(this,"info")}async load(){var t;this.I=await(t="data:image/png;base64,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",new Promise((s=>{let i=new Image;i.onload=()=>s(i),i.src=t}))),this.info="player\n\n0*1*hit\n2*3*jump\n4*5*attack\n6*7*idle\n8*11*walk\n\n0*0*16*16*80*80*16*16\n0*0*16*16*96*80*16*16\n0*0*16*16*112*80*16*16\n0*0*16*16*80*96*16*16\n0*0*16*16*96*96*16*16\n0*0*16*16*112*96*16*16\n0*0*16*16*80*112*16*16\n0*0*16*16*96*112*16*16\n0*0*16*16*112*112*16*16\n0*0*16*16*80*128*16*16\n0*0*16*16*96*128*16*16\n0*0*16*16*112*128*16*16\n\n\nsun\n\n0*0*idle\n1*1*idle2\n\n0*0*80*80*0*0*80*80\n0*0*80*80*0*80*80*80".split("\n\n\n").map((t=>{let[s,i,e]=t.split("\n\n");return{name:s,tags:i.split("\n").map((t=>{let[s,i,e]=t.split("*");return{from:parseInt(s),to:parseInt(i),name:e}})),U:e.split("\n").map((t=>{let[s,i,e,h,r,n,A,a]=t.split("*").map((t=>parseInt(t)));return{fx:s,fy:i,S:e,P:h,Y:r,j:n,Z:A,R:a,duration:100}}))}}))}},a="#4181bd",o="#b4aec5",c="#eeeaf6",l="#183452",u="#b42c73",g="#de505a",w="#20eea4",d="#8b81b4",x={K:a,background:o,W:c,G:l,J:u,red:g,green:w,X:d,all:[o,l,c,a,g,u,w,d]},f=class{constructor(t,s){this.canvas=t,this.O=s}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(t=x.background){let{O:s}=this;s.clearRect(0,0,this.width,this.height)}rect(t=x.red,s,i,e,h){let{O:r}=this;r.fillStyle=t,r.fillRect(s,i,e,h)}q(t=x.red,s,i,e,h){let{O:r}=this;r.strokeStyle=t,r.lineWidth=1,r.strokeRect(s+1,i+1,e-2,h-2)}N(t,s,i,e=64,h=x.W){let{O:r}=this,n=r.measureText(t).width;return r.font=`${e}px 'Courier New', monospace`,r.fillStyle=h,r.fillText(t,s,i),n}V(t,s,i,e=1,h=1){let{fx:r,fy:n,Y:A,j:a,Z:o,R:c}=t.current_frame,{T:l,$:u}=t,g=s-r-l,w=i-n-u;this.tt(g,w,A,a,o,c,e,h)}tt(t,s,i,e,h,r,n,a){let{O:o}=this,{I:c}=A;o.save();let l=h,u=r,g=l*Math.abs(n),w=u*Math.abs(a);o.scale(n,a),n<0&&(t*=-1,t-=g),a<0&&(s*=-1,s-=w),o.drawImage(c,i,e,l,u,Math.round(t),Math.round(s),g,w),o.restore()}};s(f,"make",((t,s,i=!0)=>{let e=document.createElement("canvas");i&&e.classList.add("pixelated");let h=e.getContext("2d");const r=()=>{e.width=t,e.height=s,h.imageSmoothingEnabled=i};return document.addEventListener("resize",r),r(),new f(e,h)}));let p=f;class y{constructor(){s(this,"_data"),s(this,"life"),s(this,"objects"),this.st=[]}it(t){return this.et=t,this}ht(t,s){return(new t).it(s).init()}make(t,s={}){let i=this.ht(t,s);return this.st.push(i),i}remove(t){let s=this.st.indexOf(t);if(-1===s)throw"noscene rm";this.st.splice(s,1)}init(){return this.rt=0,this.nt(),this}update(){0===this.rt&&this.At(),this.st.forEach((t=>t.update())),this.rt+=i.delta,this.ot()}ct(t,s){this.lt(t,s),this.st.forEach((i=>i.ct(t,s))),this.ut(t,s)}nt(){}At(){}ot(){}ut(t,s){}lt(t,s){}}class m extends y{constructor(){super(...arguments),s(this,"x",0),s(this,"y",0),s(this,"scale_x",1),s(this,"scale_y",1),s(this,"_current_frame",0),s(this,"__elapsed",0)}get data(){return this.et}get info(){let t=A.info.find((t=>t.name));if(!t)throw`nosprite ${this.gt}`;return t}get tag(){let t=this.info.tags.find((t=>t.name===this.wt));if(!t)throw`notag ${this.gt} ${this.wt}`;return t}get gt(){return this.data.name}get wt(){return this.data.tag||"idle"}dt(t,s){this.x=t,this.y=s}get current_frame(){let{from:t}=this.tag;return this.info.U[this._current_frame+t]}get xt(){return this.data.xt??"c"}get T(){if("tl"===this.xt)return 0;let{S:t}=this.current_frame;return"c"===this.xt||"bc"===this.xt?t/2:0}get $(){if("tl"===this.xt)return 0;let{P:t}=this.current_frame;return"c"===this.xt?t/2:"bc"===this.xt?t:0}ft(t){this.data.tag=t,this._current_frame=0,this.__elapsed=0}ot(){let{from:t,to:s}=this.tag,{duration:e}=this.current_frame,h=s-t;this.__elapsed+=1e3*i.delta,this.__elapsed>=e&&(this.__elapsed-=e,this._current_frame===h?this._current_frame=0:this._current_frame+=1)}ut(t,s){let{x:i,y:e,yt:h,Qt:r}=this;t.V(this,i,e,h,r)}}let Q={};const _=class{constructor(){s(this,"_fxs")}fx(t){let s=this._t[t];if(!s)throw`nosound ${t}`;var i;i=s,console.log(i)}};s(_,"make",(()=>{let t=new _;return t._t=Q,t}));const C=new _,B=class{constructor(t,s,i,e,h=!0){this.x=t,this.y=s,this.w=i,this.Ct=e,this.value=h}};s(B,"rect",((t,s,i,e)=>new B(t,s,i,e))),s(B,"hline",((t,s,i)=>new B(t,s,i,1))),s(B,"vline",((t,s,i)=>new B(t,s,1,i)));let b=B;const M=class{constructor(t){this.grid=t}Bt(t){let s=Math.floor(t.x/8),i=Math.floor(t.y/8),e=Math.floor((t.x+t.w-1)/8),h=Math.floor((t.y+t.Ct-1)/8);for(let r=s;r<=e;r++)for(let s=i;s<=h;s++)this.grid[r][s]=t.value}bt(t,s,i){let{x:e,y:h,w:r,Ct:n}=t;return this.Mt(e+s,h+i,r,n)}Mt(t,s,i=1,e=1){let h=Math.floor(t/8),r=Math.floor(s/8),n=Math.floor((t+i-1)/8),A=Math.floor((s+e-1)/8);if(h<0||n>=40||r<0||A>=23)throw`outbounds ${t} ${s}`;for(t=h;t<=n;t++)for(s=r;s<=A;s++)if(this.grid[t][s])return!0;return!1}};s(M,"make",(()=>{let t=[];for(let i=0;i<40;i++)t.push(new Array(23).fill(!1));let s=new M(t);return s.Bt(b.hline(0,172,320)),s}));let E=M,k=[x.red,x.J];class D extends y{constructor(){super(...arguments),s(this,"grid")}nt(){this.grid=E.make()}ut(t){for(let s=0;s<320;s+=8)for(let i=0;i<180;i+=8)this.grid.Mt(s,i)&&t.q(k[(s+i)/8%2],s,i,8,8)}}const F=((t=1)=>()=>{var s=1e4*Math.sin(t++);return s-Math.floor(s)})();function v(t){return t[function(t,s=F){return Math.floor(s()*t)}(t.length)]}class L extends y{constructor(){super(...arguments),s(this,"world"),s(this,"solid")}init(){return this.Et=this.make(I),this.kt=this.make(D),this.nt(),this}ot(){let{grid:t}=this.kt,{Dt:s}=this.Et;s.forEach((s=>{for(let e=0;e<3;e++){let e=Math.abs(s.dx),h=Math.sign(s.dx);for(let n=1/3;n<=e;n+=1/3){if(t.bt(s,h*n*i.delta,0)){s.dx=0;break}s.x+=h*n*i.delta}let r=Math.abs(s.dy);h=Math.sign(s.dy);for(let n=1/3;n<=r;n+=1/3){if(t.bt(s,0,h*n*i.delta)){s.dy=0;break}s.y+=h*n*i.delta}}}))}}class H extends y{constructor(){super(...arguments),s(this,"_w"),s(this,"_h"),s(this,"x"),s(this,"y"),s(this,"dx"),s(this,"dy")}get data(){return this.et}get w(){return this.Ft}get Ct(){return this.vt}init(){return this.x=this.data.x??0,this.y=this.data.y??0,this.Ft=this.data.w,this.vt=this.data.Ct,this.dx=0,this.dy=0,super.init()}}class I extends y{get Dt(){return this.st}body(t,s={}){return this.make(t,s)}ot(){}}class U extends H{constructor(){super(...arguments),s(this,"anim")}get data(){return this.et}init(){return this.V=this.make(m,this.data),super.init()}update(){this.V.x=this.x,this.V.y=this.y,super.update()}}const S=3.6912;class z extends U{ot(){n.D("left")?(this.V.yt=-1,this.dx=-3.6912):n.D("right")?(this.V.yt=1,this.dx=S):this.dx=0}}class P extends y{get data(){return this.et}ut(t){let{color:s,x:i,y:e,w:h,Ct:r}=this.data;t.q(s,i,e,h,r)}}class Y extends y{get data(){return this.et}ut(t){let{color:s,x:i,y:e,w:h,Ct:r}=this.data;t.rect(s,i,e,h,r)}}class j extends y{constructor(){super(...arguments),s(this,"align"),s(this,"blue_text"),s(this,"retro_text")}nt(){this.align=[],this.make(Y,{color:x.background,x:0,y:0,w:320,Ct:180}),this.make(Y,{color:x.G,x:3,y:2,w:84,Ct:42}),this.make(P,{color:x.K,x:3,y:2,w:84,Ct:42}),this.make(P,{color:x.red,x:2,y:1,w:86,Ct:44}),this.Lt=this.make(X,{x:50,y:100,size:74,text:"blue"}),this.Ht=this.make(X,{x:50,y:100,size:74,text:"retro"}),this.align.push({margin:89,Ct:[this.Lt,this.Ht]}),this.make(X,{x:50,y:170,size:54,text:"undescent"}),this.make(X,{x:50,y:228,size:54,text:"ipsum dolor"})}ot(){this.align.forEach((t=>{var s;let i=t.margin??0;null==(s=t.Ct)||s.reduce(((t,s)=>(s.x=t.x+t.width+i,s)))}))}}class Z extends y{constructor(){super(...arguments),s(this,"parent")}It(t,s={}){let i=this.make(t,s);return i.parent=this,i}Ut(t,s={}){var i,e;null==(i=this.parent)||i.remove(this),null==(e=this.parent)||e.It(t,s)}}class R extends Z{nt(){this.make(j),this.make(O)}}class K extends Z{constructor(){super(...arguments),s(this,"begin_text1"),s(this,"begin_text2")}At(){}nt(){this.make(Y,{color:x.G,x:0,y:0,w:320,Ct:180}),this.make(X,{x:50,y:170,size:112,text:"2 minute ssir..",color:x.W}),this.make(X,{x:960,y:540,size:112,text:"blue retro",color:x.W}),this.make(X,{x:640,y:900,size:112,text:"by",color:x.W}),this.make(J,{x:840,y:900,size:112,text:"eguneys",color:x.W}),this.St=this.make(X,{x:960,y:1030,size:62,text:"click to begin",color:x.W}),this.zt=this.make(X,{x:2880,y:1030,size:62,text:"click to begin",color:x.W})}ot(){this.St.x+=300*i.delta,this.zt.x+=300*i.delta,this.St.x+this.St.width>1920&&(this.zt.x=this.St.x-1920),this.zt.x+this.zt.width>1920&&(this.St.x=this.zt.x-1920),n.M("jump")&&(C.fx("start"),this.Ut(R))}}const W=class extends Z{nt(){this.It(K)}lt(t,s){t.clear(),s.clear()}};s(W,"make",(()=>(new W).init()));let G=W;class J extends y{constructor(){super(...arguments),s(this,"_width",0),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color"),s(this,"lc")}get data(){return this.et}get width(){return this.Pt}get height(){return this.size}nt(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??x.W,this.Yt=[]}ot(){i.h(.2)&&(this.Yt=this.text.split("").map((t=>[t,v(x.all)])))}ut(t,s){this.Pt=0,this.Yt.map((([t,i])=>{let e=s.N(t,this.x+this.Pt,this.y,this.size,i);this.Pt+=e}))}}class X extends y{constructor(){super(...arguments),s(this,"_width",0),s(this,"x"),s(this,"y"),s(this,"size"),s(this,"text"),s(this,"color")}get data(){return this.et}get width(){return this.Pt}get height(){return this.size}nt(){this.text=this.data.text,this.x=this.data.x,this.y=this.data.y,this.size=this.data.size??64,this.color=this.data.color??x.W}ut(t,s){this.Pt=s.N(this.text,this.x,this.y,this.size,this.color)}}class O extends L{nt(){this.Et.body(z,{name:"player",x:8,y:8,xt:"bc"}).dy=4}}!async function(t){await A.load(),function(t){let s=p.make(1920,1080,!1),i=p.make(320,180),h=G.make();e.l({u(){n.update(),h.update()},B(){h.ct(i,s)}}),t.appendChild(i.canvas),t.appendChild(s.canvas)}(t)}(document.getElementById("app"));
